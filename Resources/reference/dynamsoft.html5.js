/*!
* Dynamsoft JavaScript Library
* Product: Dynamsoft Web Twain
* Web Site: http://www.dynamsoft.com
*
* Copyright 2014, Dynamsoft Corporation 
* Author: Dynamsoft Support Team
* Date: Oct 14 2014
* Version: 10.0.1.1010
*/
var DynamLib=DynamLib||{};DynamLib.images=[];(function(){var b=(window.document.addEventListener?function(c,e,d){c.addEventListener(e,d)}:function(c,e,d){c.attachEvent("on"+e,d)});var a=(window.document.removeEventListener?function(c,e,d){c.removeEventListener(e,d)}:function(c,e,d){c.detachEvent("on"+e,d)});DynamLib.addEventListener=b;DynamLib.removeEventListener=a})();var dialogPolyfill=(function(){var a={};a.reposition=function(b){var d=document.body.scrollTop||document.documentElement.scrollTop;var c=d+(window.innerHeight-b.offsetHeight)/2;b.style.top=c+"px";b.dialogPolyfillInfo.isTopOverridden=true};a.inNodeList=function(b,d){for(var c=0;c<b.length;++c){if(b[c]==d){return true}}return false};a.isInlinePositionSetByStylesheet=function(d){for(var f=0;f<document.styleSheets.length;++f){var m=document.styleSheets[f];var h=null;try{h=m.cssRules}catch(g){}if(!h){continue}for(var c=0;c<h.length;++c){var l=h[c];var n=null;try{n=document.querySelectorAll(l.selectorText)}catch(g){}if(!n||!a.inNodeList(n,d)){continue}var b=l.style.getPropertyValue("top");var k=l.style.getPropertyValue("bottom");if((b&&b!="auto")||(k&&k!="auto")){return true}}}return false};a.needsCentering=function(c){var b=getComputedStyle(c);if(b.position!="absolute"){return false}if((c.style.top!="auto"&&c.style.top!="")||(c.style.bottom!="auto"&&c.style.bottom!="")){return false}return !a.isInlinePositionSetByStylesheet(c)};a.showDialog=function(c){if(this.open){throw"InvalidStateError: showDialog called on open dialog"}this.open=true;this.setAttribute("open","open");if(c){var b=null;var e=null;var d=function(f){for(var g=0;g<f.children.length;g++){var h=f.children[g];if(b===null&&!h.disabled&&(h.nodeName=="BUTTON"||h.nodeName=="INPUT"||h.nodeName=="KEYGEN"||h.nodeName=="SELECT"||h.nodeName=="TEXTAREA")){b=h}if(h.autofocus){e=h;return}d(h);if(e!==null){return}}};d(this);if(e!==null){e.focus()}else{if(b!==null){b.focus()}}}if(a.needsCentering(this)){a.reposition(this)}if(c){this.dialogPolyfillInfo.modal=true;a.dm.pushDialog(this)}};a.close=function(b){if(!this.open){throw new InvalidStateError}this.open=false;this.removeAttribute("open");if(typeof b!="undefined"){this.returnValue=b}if(this.dialogPolyfillInfo.isTopOverridden){this.style.top="auto"}if(this.dialogPolyfillInfo.modal){a.dm.removeDialog(this)}var c;if(document.createEvent){c=document.createEvent("HTMLEvents");c.initEvent("close",true,true)}else{c=new Event("close")}this.dispatchEvent(c);return this.returnValue};a.registerDialog=function(b){if(b.show){}DynamLib.addEventListener(b,"dialog_submit",function(c){b.close(c.detail.target.value);c.preventDefault();c.stopPropagation()});b.show=a.showDialog.bind(b,false);b.showModal=a.showDialog.bind(b,true);b.close=a.close.bind(b);b.dialogPolyfillInfo={}};TOP_LAYER_ZINDEX=100000;MAX_PENDING_DIALOGS=100000;a.DialogManager=function(){this.pendingDialogStack=[];this.overlay=document.createElement("div");this.overlay.style.width="100%";this.overlay.style.height="100%";this.overlay.style.position="fixed";this.overlay.style.left="0px";this.overlay.style.top="0px";this.overlay.style.backgroundColor="rgba(0,0,0,0.0)";DynamLib.addEventListener(this.overlay,"click",function(b){var c=document.createEvent("MouseEvents");c.initMouseEvent(b.type,b.bubbles,b.cancelable,window,b.detail,b.screenX,b.screenY,b.clientX,b.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,b.button,b.relatedTarget);document.body.dispatchEvent(c)});DynamLib.addEventListener(window,"load",function(){var b=document.getElementsByTagName("form");Array.prototype.forEach.call(b,function(c){if(c.getAttribute("method")=="dialog"){DynamLib.addEventListener(c,"click",function(f){if(f.target.type=="submit"){var d;if(CustomEvent){d=new CustomEvent("dialog_submit",{bubbles:true,detail:{target:f.target}})}else{d=document.createEvent("HTMLEvents");d.initEvent("dialog_submit",true,true);d.detail={target:f.target}}this.dispatchEvent(d);f.preventDefault()}})}})})};a.dm=new a.DialogManager();a.DialogManager.prototype.blockDocument=function(){if(!document.body.contains(this.overlay)){document.body.appendChild(this.overlay)}};a.DialogManager.prototype.unblockDocument=function(){document.body.removeChild(this.overlay)};a.DialogManager.prototype.updateStacking=function(){if(this.pendingDialogStack.length==0){this.unblockDocument();return}this.blockDocument();var d=TOP_LAYER_ZINDEX;for(var c=0;c<this.pendingDialogStack.length;c++){if(c==this.pendingDialogStack.length-1){this.overlay.style.zIndex=d++}var b=this.pendingDialogStack[c];b.dialogPolyfillInfo.backdrop.style.zIndex=d++;b.style.zIndex=d++}};a.DialogManager.prototype.pushDialog=function(c){if(this.pendingDialogStack.length>=MAX_PENDING_DIALOGS){throw"Too many modal dialogs"}var b=document.createElement("div");b.classList.add("backdrop");DynamLib.addEventListener(b,"click",function(d){var f=document.createEvent("MouseEvents");f.initMouseEvent(d.type,d.bubbles,d.cancelable,window,d.detail,d.screenX,d.screenY,d.clientX,d.clientY,d.ctrlKey,d.altKey,d.shiftKey,d.metaKey,d.button,d.relatedTarget);c.dispatchEvent(f)});c.parentNode.insertBefore(b,c.nextSibling);c.dialogPolyfillInfo.backdrop=b;this.pendingDialogStack.push(c);this.updateStacking()};a.DialogManager.prototype.removeDialog=function(d){var c=this.pendingDialogStack.indexOf(d);if(c==-1){return}this.pendingDialogStack.splice(c,1);var b=d.dialogPolyfillInfo.backdrop;b.parentNode.removeChild(b);d.dialogPolyfillInfo.backdrop=null;this.updateStacking()};return a})();(function(a,b){var j=document,f=[],c="eng",i=b.Event,k=15000,g={btninfo:["previous","next","rotateleft","rotate","rotateright","deskew","crop","changeimagesize","flip","mirror","zoomin","originalsize","zoomout","stretch","fullscreen","fit","fitw","fith","print","hand","rectselect","restore","save"],titlelan:["eng","chi"],titles:[["Previous Image","Next Image","Rotate Left","Rotate","Rotate Right","De Skew","Crop Selected Area","Change Image Size","Flip","Mirror","Zoom In","Original Size","Zoom Out","Stretch Mode","Full Screen","Fit Canvas","Fit Vertically","Fit Horizontally","Print","Hand","Select","Restore","Save Changes"],["Previous Image","Next Image","Rotate Left","Rotate","Rotate Right","De Skew","Crop Selected Area","Change Image Size","Flip","Mirror","Zoom In","Original Size","Zoom Out","Stretch Mode","Full Screen","Fit Canvas","Fit Vertically","Fit Horizontally","Print","Hand","Select","Restore","Save Changes"]]},l={isFunction:function(m){return m&&typeof(m)==="function"},getHex:function(n){var m;m=Number(n).toString(16).toUpperCase();if(m.length==1){m=["0",m].join("")}return m},getColor:function(o){var n,m,q,p;m=o>>16;q=(o&65280)>>8;p=o&255;n=["#",l.getHex(p),l.getHex(q),l.getHex(m)].join("");return n},__adjustImageSize:function(o,r,n){if(r<=o.width||n<=o.height){if(r<=o.width&&n<=o.height){var q=r/o.width,m=n/o.height,p;if(q<m){o.width=Math.floor(o.width*q);o.height=Math.floor(o.height*q)}else{o.width=Math.floor(o.width*m);o.height=Math.floor(o.height*m)}}else{if(r<=o.width){o.width=r;o.height=Math.floor((r/o.width)*o.height)}else{if(n<=o.height){o.width=Math.floor((n/o.height)*o.width);o.height=n}}}}},init:function(p,n){var q=p,o=n||{},m=Math.floor(Math.random()*100000+1);q.containerID=o.containerID||("dwt-container-"+m);q.defaultIndex=0;q.width=o.width||580;q.height=o.height||600;q.bEdit=o.bEdit||false;q.scrollWidth=5;q.evt_switch=o.evt_switch||"";q.evt_mouseMove=o.evt_mouseMove||"";q.evt_mouseIn=o.evt_mouseIn||"";q.evt_mouseOut=o.evt_mouseOut||"";q.evt_mouseClick=o.evt_mouseClick||"";q.evt_mouseDblClick=o.evt_mouseDblClick||"";q.debug=o.debug?true:false;q.selectionImageBorderColor=false;q.backgroundColor=false;q.onRefreshUI=o.onRefreshUI||false;q.onMouseRightClick=o.onMouseRightClick||false;q.onMouseClick=o.onMouseClick||false;q.onMouseDoubleClick=o.onMouseDoubleClick||false;q.onMouseMove=o.onMouseMove||false;f.push(q)},setImageUIViewSize:function(n,m,o){var p=n;p.containerWidth=m;p.containerHeight=o;p.width=p.containerWidth-15;p.height=p.containerHeight-2;p.widthPerImage=Math.floor((p.width-p.scrollWidth)/p.imagesPerRow)-p.ImageMargin;p.heightPerImage=Math.floor(p.height/p.imagesPerColumn)-p.ImageMargin;p.UIViewList.setStyles({width:(m-2)+"px",height:(o-2)+"px","overflow-x":"hidden","overflow-y":"auto"})},addClass:function(n,m){b.one(n).addClass(m)},removeClass:function(n,m){b.one(n).removeClass(m)},print:function(q,r){var t=q,o;var n,s=["alwaysRaised=yes,z-look=yes,top=0,left=0,toolbar=no,menubar=no,location=no,status=no,width=",t.width,",height=",t.height].join(""),o='<html><body><img id="D_img" src="'+r+'" /></body></html>';var m=window.open("about:blank","_blank",s);m.document.write(o);m.document.close();m.focus();n=m.document.getElementById("D_img");if(n){n.onload=function(){m.print();m.close();a.log("print image...ok")}}else{a.log("cannot find image")}},getToolBar:function(v,m,x){var u;for(var r=0;r<g.titlelan.length;r++){if(g.titlelan[r]==c){u=g.titles[r];break}else{u=g.titles[0]}}var p=document.createElement("ul");var q=g.btninfo.length;var n=m/q>x?x*0.8:m/q*0.8;n=Math.floor(n);var w=document.createElement("li");w.style.padding="0";w.style.margin="0";w.style.width=m+"px";w.style.height=x+"px";for(var t=0;t<q;t++){var s=document.createElement("img");s.src="Resources/reference/imgs/"+g.btninfo[t]+".png";s.className="Class_D_DWT_Editor_Buttons_"+g.btninfo[t];s.title=u[t];s.style.width=n+"px";s.style.height=n+"px";s.style.paddingTop=n/8+"px";switch(g.btninfo[t]){case"previous":s.onclick=function(){v.previous_btn()};break;case"next":s.onclick=function(){v.next_btn()};break;case"rotateleft":s.style.marginLeft=n+"px";s.onclick=function(){v.RotateLeft()};break;case"rotate":s.onclick=function(){v.RotateAnyAngle()};break;case"rotateright":s.onclick=function(){v.RotateRight()};break;case"deskew":s.onclick=function(){v.Deskew()};break;case"crop":s.onclick=function(){v.Crop_btn()};break;case"changeimagesize":s.onclick=function(){v.ChangeImageSizeGetinput()};break;case"flip":s.onclick=function(){v.Flip()};break;case"mirror":s.onclick=function(){v.Mirror()};break;case"zoomin":s.style.marginLeft=n+"px";s.onclick=function(){v.ZoomIn()};break;case"originalsize":s.onclick=function(){v.OriginalSize()};break;case"zoomout":s.onclick=function(){v.ZoomOut()};break;case"stretch":s.onclick=function(){v.StrechMode()};break;case"fullscreen":s.onclick=function(){v.fullscreen()};break;case"fit":s.onclick=function(){v.FitsWindowSize()};break;case"fitw":s.onclick=function(){v.FitsWindowWidth()};break;case"fith":s.onclick=function(){v.FitsWindowHeight()};break;case"print":s.onclick=function(){v.print()};break;case"hand":s.style.marginLeft=n+"px";s.onclick=function(){v.setMouseShape(true)};break;case"rectselect":s.style.marginLeft=n+"px";s.onclick=function(){v.setMouseShape(false)};break;case"restore":s.style.display="none";s.style.marginLeft=n+"px";s.onclick=function(){v.RestoreImage()};break;case"save":s.style.display="none";s.onclick=function(){v.SaveImage()};break}w.appendChild(s)}var y=document.createElement("img");y.src="Resources/reference/imgs/close.png";y.style.width=n+"px";y.style.height=n+"px";y.style.paddingTop=n/8+"px";y.title="Click to Close Window";y.className="floatRight";y.onclick=function(){v.HideImageEditor()};w.appendChild(y);p.appendChild(w);return p},output:function(n,m){if(n.debug){console.log(m)}}};function e(n){var q=this,o=n||{},m,p='<ul class="D_ImageUIView_List"></ul>';l.init(q,o);q.onSelected=o.onSelected||false;q.cIndex=-1;q.bFocus=false;q.aryImages=[];q.AllowMultiSelect=true;q.selectedIndexes=[];q.selectedClass="D-ImageUI-selected";q.highlightClass="D-ImageUI-highlight";q.imagesPerRow=1;q.imagesPerColumn=1;q.bYScroll=true;q.ImageMargin=10;m=b.one("#"+q.containerID);m.append(p);q.UIViewList=m.one(".D_ImageUIView_List");q.UIViewList.attr("class","noPaddingnoMargin thinborder thumbContainer");l.setImageUIViewSize(q,o.width,o.height);i.on(q.UIViewList,"mouseup",function(r){if(r.which?r.which==3:r.button==2){q.fire("onMouseRightClick",q.cIndex)}else{q.fire("onMouseClick",q.cIndex)}});i.on(q.UIViewList,"dblclick",function(r){q.fire("onMouseDoubleClick",q.cIndex)});i.on(q.UIViewList,"mouseenter",function(r){q.bFocus=true;q.fire("onMouseMove",q.cIndex)});i.on(q.UIViewList,"mouseleave",function(r){q.bFocus=false;q.fire("onMouseMove",-1)});i.on(q.UIViewList,"mousewheel",function(r){if(!q.bFocus){return true}var s=r.delta;if(s<0){q.next();q.fire("onRefreshUI",q.cIndex)}else{if(s>0){q.previous();q.fire("onRefreshUI",q.cIndex)}}return false})}e.prototype.unregistEvents=function(){var n=this,m=f.indexOf(n);if(m>=0){f.splice(m,1)}i.detach(n.UIViewList)};e.prototype.handlerKeyDown=function(n){var o=this,m=true;if(!o.bFocus){return m}switch(n.keyCode){case 37:m=false;o.previous();o.fire("onRefreshUI",o.cIndex);break;case 39:m=false;o.next();o.fire("onRefreshUI",o.cIndex);break;case 38:m=false;o.previousUp();o.fire("onRefreshUI",o.cIndex);break;case 40:m=false;o.nextDown();o.fire("onRefreshUI",o.cIndex);break;case 33:m=false;o.pageUp();o.fire("onRefreshUI",o.cIndex);break;case 34:m=false;o.pageDown();o.fire("onRefreshUI",o.cIndex);break;case 35:m=false;o.go(o.count()-1);o.fire("onRefreshUI",o.cIndex);break;case 36:m=false;o.go(0);o.fire("onRefreshUI",o.cIndex);break;case 82:break;case 107:break;case 109:break}return m};e.prototype.fullscreen=function(){var m=this;l.output(m,"fullscreen")};e.prototype.previous=function(m){var o=this,n=o.count();if(n==0){o.cIndex=-1;return}if(o.cIndex<=0){o.cIndex=0}else{o.cIndex--}o.selectedIndexes=[];if(o.cIndex>=0&&o.cIndex<n){o.selectedIndexes.push(o.cIndex)}o._refreshSelection();o._refreshScroll();if(l.isFunction(m)){m()}};e.prototype.previousUp=function(){var n=this,m=n.count();if(m==0){n.cIndex=-1;return}if(n.bYScroll){n.cIndex-=n.imagesPerRow}else{n.cIndex--}if(n.cIndex<=0){n.cIndex=0}n.selectedIndexes=[];if(n.cIndex>=0&&n.cIndex<m){n.selectedIndexes.push(n.cIndex)}n._refreshSelection();n._refreshScroll()};e.prototype.pageUp=function(){var n=this,m=n.count();if(m==0){n.cIndex=-1;return}if(n.bYScroll){n.cIndex-=n.imagesPerRow*n.imagesPerColumn}else{n.cIndex--}if(n.cIndex<=0){n.cIndex=0}n.selectedIndexes=[];if(n.cIndex>=0&&n.cIndex<m){n.selectedIndexes.push(n.cIndex)}n._refreshSelection();n._refreshScroll()};e.prototype.next=function(m){var o=this,n=o.count();if(n==0){o.cIndex=-1;return}if(o.cIndex>=n-1){o.cIndex=n-1}else{o.cIndex++}o.selectedIndexes=[];if(o.cIndex>=0&&o.cIndex<n){o.selectedIndexes.push(o.cIndex)}o._refreshSelection();o._refreshScroll();if(l.isFunction(m)){m()}};e.prototype.nextDown=function(){var n=this,m=n.count();if(m==0){n.cIndex=-1;return}if(n.bYScroll){n.cIndex+=n.imagesPerRow}else{n.cIndex++}if(n.cIndex>=m-1){n.cIndex=m-1}n.selectedIndexes=[];if(n.cIndex>=0&&n.cIndex<m){n.selectedIndexes.push(n.cIndex)}n._refreshSelection();n._refreshScroll()};e.prototype.pageDown=function(){var n=this,m=n.count();if(m==0){n.cIndex=-1;return}if(n.bYScroll){n.cIndex+=n.imagesPerRow*n.imagesPerColumn}else{n.cIndex++}if(n.cIndex>=m-1){n.cIndex=m-1}n.selectedIndexes=[];if(n.cIndex>=0&&n.cIndex<m){n.selectedIndexes.push(n.cIndex)}n._refreshSelection();n._refreshScroll()};e.prototype.clear=function(){var m=this;m.aryImages=[];m.cIndex=-1;m.selectedIndexes=[];m.UIViewList.children().remove()};e.prototype.remove=function(n){var p=this,o=n*1,m=p.count();if(b.isUndefined(o)||o<0){return}if(o>=m){o=m-1}p.aryImages.splice(o,1);p.UIViewList.children().item(o).remove();if(p.cIndex>=p.aryImages.length){p.cIndex=p.aryImages.length-1}b.each(p.UIViewList.children(),function(s,r){var t=b.one(s);if(t){var q=t.one(".imgTag");if(q){q.html(r*1+1);b.DOM.data(q,"n",r*1)}}});p.selectedIndexes=[];if(p.cIndex>=0&&p.cIndex<m){p.selectedIndexes.push(p.cIndex)}p._refreshSelection();p._refreshScroll()};e.prototype.refresh=function(){var n=this;n.UIViewList.children().remove();DynamLib.images=[];for(var m=0;m<n.aryImages.length;m++){n.aryImages[m].bNew=true;n.showImage(m)}};e.prototype.print=function(){var o=this,n=o._UIView.currentTab,m;if(n<0){return}m=o.aryImages[n].src;l.print(o,m)};e.prototype.getMousePosition=function(){var m=this;l.output(m,"getMousePosition")};e.prototype.show=function(){var m=this;m.UIViewList.style("display","")};e.prototype.hide=function(){var m=this;m.UIViewList.style("display","none")};e.prototype.SetViewMode=function(t,r){var u=this,q=u.cIndex,s,p,n;p=u.imagesPerRow*u.imagesPerColumn;if(p<0){p=1}n=t*r;if(n<0){n=1}u.imagesPerRow=t;u.imagesPerColumn=r;if(r==-1){u.bYScroll=false;u.imagesPerRow=1;u.imagesPerColumn=1;u.width=u.containerWidth-2;u.height=u.containerHeight-15;if(u.selectionImageBorderColor){u.width-=2;u.height-=2}u.UIViewList.style("overflow-x","auto");u.UIViewList.style("overflow-y","hidden");u.widthPerImage=Math.floor((u.width)/u.imagesPerRow)-u.ImageMargin;u.heightPerImage=Math.floor((u.height-u.scrollWidth)/u.imagesPerColumn)-u.ImageMargin;var m=b.one("#"+u.containerID);m.style("white-space","nowrap")}else{u.bYScroll=true;u.width=u.containerWidth-15;u.height=u.containerHeight-2;if(u.selectionImageBorderColor){u.width-=2;u.height-=2}u.UIViewList.style("overflow-y","auto");u.UIViewList.style("overflow-x","hidden");u.widthPerImage=Math.floor((u.width-u.scrollWidth)/u.imagesPerRow)-u.ImageMargin;u.heightPerImage=Math.floor(u.height/u.imagesPerColumn)-u.ImageMargin;var m=b.one("#"+u.containerID);m.style("white-space","")}b.each(u.UIViewList.children(),function(z){var B=b.one(z);if(B){var v=B.one(".imgwrap"),y=v.one("img"),o=B.one(".imgTag"),w=u.widthPerImage/25<30?30:u.widthPerImage/25;if(u.bYScroll){B.style("float","left").style("display","inline");o.style("display","inline")}else{B.style("float","").style("display","inline-block");o.style("display","inline-block")}B.style("height",u.heightPerImage+"px");B.style("width",u.widthPerImage+"px");v.style("height",u.heightPerImage+"px");v.style("width",u.widthPerImage+"px");if(o){o.style("width",w+"px")}if(y){var x,A;if(p<n){x={width:y[0].width,height:y[0].height}}else{A=b.DOM.data(v);if(!A){return true}x={width:A.w,height:A.h}}if(x){l.__adjustImageSize(x,u.widthPerImage,u.heightPerImage);y[0].width=x.width;y[0].height=x.height}}}});s=u.UIViewList.children().item(q);if(s){if(u.bYScroll){b.DOM.scrollIntoView(s,[m=u.UIViewList,top=true])}else{b.DOM.scrollIntoView(s,[m=u.UIViewList,top=true,hscroll=true])}}};e.prototype.GetViewModeH=function(){var m=this;return m.imagesPerRow};e.prototype.GetViewModeV=function(){var m=this;return m.imagesPerColumn};e.prototype.go=function(o,m){var q=this,p=o,n=q.count();if(b.isUndefined(p)||p<0||p>=n){p=q.cIndex}q.cIndex=p;q.selectedIndexes=[];if(q.cIndex>=0&&q.cIndex<n){q.selectedIndexes.push(q.cIndex)}q._refreshSelection();q._refreshScroll();if(l.isFunction(m)){m()}};e.prototype.isFirst=function(){var m=this;return m.cIndex===0};e.prototype.isLast=function(){var n=this,m=n.count();return n.cIndex!==-1&&n.cIndex===(m-1)};e.prototype._refreshSelection=function(){var m=this;m.unHighlightAll();m.hightlight(m.selectedIndexes)};e.prototype.fire=function(m,n){var o=this;if(l.isFunction(o[m])){o[m](n)}};e.prototype.hightlight=function(m){var q=this,p;if(typeof m==="object"){for(var n=0;n<m.length;n++){p=q.UIViewList.children().item(m[n]);if(p){p.addClass(q.selectedClass);if(q.selectionImageBorderColor){p.one(".imgwrap").style("border",["1px solid ",q.selectionImageBorderColor].join(""))}}}}};e.prototype.unHighlightAll=function(){var m=this;m.UIViewList.all("."+m.selectedClass).removeClass(m.selectedClass);m.UIViewList.all(".imgwrap").style("border","")};e.prototype.showImage=function(x){var w=this,x=parseInt(x),s,q,o,v;s=w.widthPerImage/25<30?30:w.widthPerImage/25;q=w.aryImages[x];o=q.bNew;if(o){var m=document.createElement("div"),t=b.one(m);t.addClass("imgwrap").addClass("imgBox");if(w.backgroundColor){m.style.backgroundColor=w.backgroundColor}v=new Image();v.onload=function(){var z=b.DOM.data(t);z.w=v.width;z.h=v.height;l.__adjustImageSize(v,w.widthPerImage,w.heightPerImage);if(t.children().length==0){t.append(v)}};DynamLib.images.push({image:v,url:w.aryImages[x].src,bNew:true});var u=document.createElement("div");u.innerHTML=(x*1+1);u.className="imgTag";u.style.width=s+"px";b.DOM.data(u,"n",x);var y=document.createElement("li");y.className="thumb";y.style.height=w.heightPerImage+"px";y.style.width=w.widthPerImage+"px";y.style.margin=[w.ImageMargin/2,"px"].join("");t.style("height",w.heightPerImage+"px");t.style("width",w.widthPerImage+"px");if(w.bYScroll){b.one(y).style("float","left").style("display","inline");u.style.display="inline"}else{y.style.display="inline";u.style.display="inline-block"}y.appendChild(m);y.appendChild(u);i.on(y,"click",function(D){var C=b.DOM.data(u,"n");var F=w.selectedIndexes.indexOf(C),z=D.ctrlKey,E=D.shiftKey;if(F==-1){if(z||E||w.selectedIndexes.length<1){w.selectedIndexes.push(C)}else{if(w.selectedIndexes.length==1){w.selectedIndexes[0]=C}else{w.selectedIndexes=[];w.selectedIndexes.push(C)}}}else{if(z&&w.selectedIndexes.length>1){w.selectedIndexes.splice(F,1)}else{if(E){w.selectedIndexes.push(C)}else{w.selectedIndexes=[];w.selectedIndexes.push(C)}}}if(E){var H=w.selectedIndexes[0],B=w.selectedIndexes[w.selectedIndexes.length-1];w.selectedIndexes=[];if(B==H){w.selectedIndexes.push(parseInt(H))}else{if(B>H){var G=B-H+1;for(var A=0;A<G;A++){w.selectedIndexes.push(parseInt(H+A))}}else{var G=H-B+1;w.selectedIndexes.push(parseInt(H));for(var A=0;A<G-1;A++){w.selectedIndexes.push(parseInt(B+A))}}}}if(w.selectedIndexes.length==1){w.cIndex=C}w.fire("onSelected",w.selectedIndexes);w._refreshSelection()});w.UIViewList.append(y);q.bNew=false}else{var p=w.UIViewList.children().item(x);if(p){var r=p.one(".imgwrap"),n=p.one(".imgTag");p.style("height",w.heightPerImage+"px");p.style("width",w.widthPerImage+"px");if(n){n.style("width",s+"px");n.html(x*1+1)}if(r){r.style("height",w.heightPerImage+"px");r.style("width",w.widthPerImage+"px");v=new Image();v.onload=function(){var z=b.DOM.data(r);z.w=v.width;z.h=v.height;l.__adjustImageSize(v,w.widthPerImage,w.heightPerImage);r.html("");r.append(v)};DynamLib.images.push({image:v,url:w.aryImages[x].src,bNew:false})}}}if(w.UIViewList.children().length==w.aryImages.length){w._refreshSelection()}w._refreshScroll()};e.prototype._refreshScroll=function(){var q=this,p=0,m=b.DOM,n;if(q.cIndex>=0&&q.cIndex<q.count()){n=q.UIViewList.children().item(q.cIndex)}if(n){if(q.bYScroll){m.scrollIntoView(n,[container=q.UIViewList,top=true])}else{m.scrollIntoView(n,[container=q.UIViewList,top=true,hscroll=true])}}else{if(q.bYScroll){m.scrollTop(q.UIViewList,0)}else{m.scrollLeft(q.UIViewList,0)}}};e.prototype.count=function(){var m=this;return m.aryImages.length};e.prototype.add=function(n,o){var p=this,m=parseInt(o);if(m>=p.aryImages.length){p.aryImages.push(n);p.cIndex=p.aryImages.length-1}else{if(m<0){m=0}p.cIndex=m;p.aryImages.splice(m,0,n)}if(p.cIndex>=p.aryImages.length){p.cIndex=p.aryImages.length-1}p.selectedIndexes=[];p.selectedIndexes.push(p.cIndex);p.showImage(p.cIndex);return true};e.prototype.set=function(p,r){var s=this,o=parseInt(r),m,q,n;if(o<0||o>s.aryImages.length){return false}s.cIndex=o;s.aryImages[o]=p;q=s.UIViewList.children().item(o);n=q.one(".imgwrap");m=new Image();m.onload=function(){var t=b.DOM.data(n);t.w=m.width;t.h=m.height;l.__adjustImageSize(m,s.widthPerImage,s.heightPerImage);n.html("");n.append(m)};m.src=p.src;return true};e.prototype.get=function(m,n){var o=this;if(m<0||m>o.aryImages.length){return false}return o.aryImages[m]};e.prototype.RemoveAllSelectedImages=function(){var n=this,m=n.count();n.selectedIndexes=[];if(n.cIndex>=0&&n.cIndex<m){n.selectedIndexes.push(n.cIndex)}n._refreshSelection();n._refreshScroll()};e.prototype.SwitchImage=function(o,m){var n=this;l.output(n,"SwitchImage")};e.prototype.getImageMargin=function(){var m=this;return m.ImageMargin};e.prototype.setImageMargin=function(m){var o=this,n=-1;o.ImageMargin=m;if(o.bYScroll){n=o.imagesPerColumn}o.SetViewMode(o.imagesPerRow,n)};e.prototype.getSelectionImageBorderColor=function(){var m=this;return m.selectionImageBorderColor};e.prototype.setSelectionImageBorderColor=function(n){var p=this,m=n,o=-1;if(b.isNumber(m)){m=l.getColor(m)}p.selectionImageBorderColor=m;if(p.bYScroll){o=p.imagesPerColumn}p.SetViewMode(p.imagesPerRow,o)};e.prototype.setBackgroundColor=function(n){var o=this,m=n;if(b.isNumber(m)){m=l.getColor(m)}o.backgroundColor=m;o.UIViewList.all(".imgwrap").style("background-color",m)};e.prototype.setAllowMultiSelect=function(m){var n=this;n.AllowMultiSelect=m};e.prototype.getAllowMultiSelect=function(){var m=this;return m.AllowMultiSelect};e.prototype.ChangeSize=function(m,o){var p=this;l.setImageUIViewSize(p,m,o);for(var n=0;n<p.aryImages.length;n++){p.showImage(n)}};function d(n){var q=this,o=n||{},m,p='<div class="D_ImageUIEditor"></div>';l.init(q,o);q.onMouseMove=o.onMouseMove||false;q.onImageAreaSelected=o.onImageAreaSelected||false;q.onImageAreaDeSelected=o.onImageAreaDeSelected||false;q.originalHeight=q.height;q.originalWidth=q.width;q.DWObject=o.DWObject;m=b.one("#"+q.containerID);m.append(p);q.dialog=null;q.UIEditor=m.one(".D_ImageUIEditor");q.bShow=false;q.defaultImageUrl=o.defaultImageUrl;q.mode="initial";q.originalMode=q.mode;q.originalModeBeforeFullScreen=q.mode;q.isfullscreen=false;q.isFitWindow=false;q.cIndex=-1;q.totalImagesCount=0;q.zoom=1;q.zoomInStep=1.2;q.zoomOutStep=0.8;q.aspectRatio=q.height/q.width;q.outEditorStatus={width:0,height:0,maxwide:false,maxhigh:false,resize:false};q.Image={url:q.defaultImageUrl,baseUrl:q.defaultImageUrl,width:480,height:590,imgAspectRatio:590/480,act:0,changed:false};q.toolbar={self:null,filled:false,width:0,height:0};q.scrollbar={self:null,glider:{color:"#c0c0c0",height:0},width:0,height:0,Canvas:{self:null,ctx:null}};q.canvasDIV={self:null,width:0,height:0,overflow:false,scrollTop_zero:0,scrollLeft_zero:0,baseCanvas:{self:null,ctx:null,backgroundColor:"#FFFFFF",drawArea:{width:0,height:0,baseCoordinates:{x:0,y:0}}},upperCanvas:{self:null,ctx:null,MouseShape:false,drawingRect:false,mouse_zero_x:0,mouse_zero_y:0,mouse_x:0,mouse_y:0},selectedCanvasArea:{top:0,right:0,bottom:0,left:0},selectedImageArea:{top:0,right:0,bottom:0,left:0}};q.changeMode("view");window.onresize=function(){if(q.bShow&&q.mode!="fullscreen"){if(q.outEditorStatus.maxhigh&&q.outEditorStatus.maxwide){q.outEditorStatus.resize=true;q.ShowImageEditorEx(-1,-1,-1,-1,1)}else{q.outEditorStatus.resize=false}}else{return}};DynamLib.addEventListener(j.documentElement,"fullscreenchange",function(){if(!document.fullscreen){q.exitFullScreen()}},false);DynamLib.addEventListener(j.documentElement,"msfullscreenchange",function(){if(!document.msFullScreen){q.exitFullScreen()}},false);document.addEventListener("mozfullscreenchange",function(){if(!document.mozFullScreen){q.exitFullScreen()}},false);DynamLib.addEventListener(j.documentElement,"webkitfullscreenchange",function(){if(!document.webkitIsFullScreen){q.exitFullScreen()}},false)}d.prototype.unregistEvents=function(){var n=this,m=f.indexOf(n);if(m>=0){f.splice(m,1)}};d.prototype.handlerKeyDown=function(n){var o=this,m=true;if(o.bShow){switch(n.keyCode){case 70:if(o.mode!="fullscreen"){m=false;o.isfullscreen?o.exitFullScreen():o.fullscreen()}break;case 37:if(o.canvasDIV.upperCanvas.MouseShape){m=false;if(o.canvasDIV.overflow){if(o.canvasDIV.self.scrollLeft>=10){o.canvasDIV.self.scrollLeft-=10}}}break;case 38:if(o.canvasDIV.upperCanvas.MouseShape){m=false;if(o.canvasDIV.overflow){if(o.canvasDIV.self.scrollTop>=10){o.canvasDIV.self.scrollTop-=10}}}break;case 39:if(o.canvasDIV.upperCanvas.MouseShape){m=false;if(o.canvasDIV.overflow){if(o.canvasDIV.self.scrollLeft<=o.canvasDIV.self.scrollWidth-10){o.canvasDIV.self.scrollLeft+=10}}}break;case 40:if(o.canvasDIV.upperCanvas.MouseShape){m=false;if(o.canvasDIV.overflow){if(o.canvasDIV.self.scrollTop<=o.canvasDIV.self.scrollHeight-10){o.canvasDIV.self.scrollTop+=10}}}break;case 107:m=false;o.ZoomIn();break;case 109:m=false;o.ZoomOut();break;case 45:m=false;if(o.canvasDIV.upperCanvas.MouseShape){o.setMouseShape(false)}else{o.setMouseShape(true)}break}}return m};d.prototype.getFitWindowType=function(){};d.prototype.setFitWindowType=function(m){var n=this;switch(m){case 0:n.FitsWindowSize();break;case 1:n.FitsWindowHeight();break;case 2:n.FitsWindowWidth();break;case 3:n.OriginalSize();break}};d.prototype.setBackgroundColor=function(n){var o=this,m=n;if(b.isNumber(m)){m=l.getColor(m)}o.backgroundColor=m};d.prototype.getZoom=function(){var m=this;return m.zoom};d.prototype.setZoom=function(m){var n=this;n.zoom=m;n.updateMode()};d.prototype.getMouseShape=function(){var m=this;return m.canvasDIV.upperCanvas.MouseShape};d.prototype.setMouseShape=function(m){var n=this;if(!n.bShow){l.output(n,"You can not set mouseshape under view mode.");return}if(typeof m=="boolean"){n.canvasDIV.upperCanvas.MouseShape=m;l.output(n,"MouseShaped is changed to "+m.toString());if(n.canvasDIV.upperCanvas.MouseShape){n.canvasDIV.upperCanvas.self.style.cursor="pointer";if(document.getElementsByClassName("Class_D_DWT_Editor_Buttons_hand")[0]){document.getElementsByClassName("Class_D_DWT_Editor_Buttons_hand")[0].style.display="none";document.getElementsByClassName("Class_D_DWT_Editor_Buttons_rectselect")[0].style.display=""}n.SetSelectedImageArea(0,0,0,0)}else{if(document.getElementsByClassName("Class_D_DWT_Editor_Buttons_hand")[0]){document.getElementsByClassName("Class_D_DWT_Editor_Buttons_hand")[0].style.display="";document.getElementsByClassName("Class_D_DWT_Editor_Buttons_rectselect")[0].style.display="none"}n.canvasDIV.upperCanvas.self.style.cursor="crosshair"}}else{l.output(n,'You need to use "ture" or "false" to set MouseShape.')}};d.prototype.HideImageEditor=function(){var n=this;if(n.Image.changed){if(confirm("You have changed the image, do you want to keep the change(s)?")){n.SaveImage()}else{n.RestoreImage()}}if(n.mode=="fullscreen"){n.exitFullScreen();return}n.width=n.originalWidth;n.height=n.originalHeight;n.aspectRatio=n.height/n.width;n.outEditorStatus.maxwide=false;n.outEditorStatus.maxhigh=false;var m=function(o){o.UIEditor.setStyles({width:(o.width-2)+"px",height:(o.height-2)+"px",position:""});o.changeMode(o.originalMode)};if(n.originalMode=="view"||n.originalMode=="initial"){n.UIEditor.style("none");n.bShow=false;m(n)}else{n.UIEditor.style("");n.bShow=true;n.__refreshImageSize(m)}};d.prototype.__refreshImageSize=function(o){var n=this,m=new Image();m.onload=function(){n.Image.width=m.width;n.Image.height=m.height;n.Image.imgAspectRatio=(n.Image.width==0)?1:n.Image.height/n.Image.width;if(l.isFunction(o)){o(n)}};m.src=n.Image.url};d.prototype.ShowImageEditorEx=function(n,r,m,q,o){var p=this;if(o==4){p.HideImageEditor();return}p.bShow=true;if(o==1){m=-1;q=-1}if(o==2){p.UIEditor.style("display","");p.SetViewMode(-2,-2);return}if(o==3){p.HideImageEditor()}if(m==-1){if(p.outEditorStatus.resize&&p.outEditorStatus.maxwide){m=window.innerWidth}else{if(!p.outEditorStatus.resize){p.outEditorStatus.maxwide=true;m=window.innerWidth}}}if(q==-1){if(p.outEditorStatus.resize&&p.outEditorStatus.maxhigh){q=window.innerHeight}else{if(!p.outEditorStatus.resize){q=window.innerHeight;p.outEditorStatus.maxhigh=true}}}if(n==-1){n=(window.innerWidth-m)/2}if(r==-1){r=(window.innerHeight-q)/2}if(p.mode!="editor_out"||p.outEditorStatus.resize){p.width=m;p.height=q;p.outEditorStatus.width=m;p.outEditorStatus.height=q;p.aspectRatio=p.height/p.width}else{l.output(p,"The editor is already shown");return}p.UIEditor.setStyles({display:"",width:(m-2)+"px",height:(q-2)+"px","z-index":"998",position:"fixed",left:n,top:r});p.changeMode("editor_out")};d.prototype.fire=function(m,n){var o=this;if(l.isFunction(o[m])){o[m](n)}};d.prototype.SetViewMode=function(n,m){var o=this;if(n==-1&&m==-1){o.changeMode("edit");o.FitsWindowSize()}else{if(n==-2&&m==-2){o.changeMode("editor")}}};d.prototype.changeMode=function(n,m){var o=this;l.output(o,"changeMode to: "+n);if(n=="view"||n=="edit"||n=="editor"||n=="fullscreen"||n=="editor_out"){if(o.mode!=n||o.outEditorStatus.resize){o.outEditorStatus.resize=false;if(o.mode!="editor_out"&&o.mode!="editor"&&o.mode!="fullscreen"){o.originalMode=o.mode}o.mode=n;if(n=="view"){o.DWObject._UIView.show();o.UIEditor.hide()}else{o.DWObject._UIView.hide();o.UIEditor.show()}}else{if(!m){l.output(o,"The current mode is already "+n);return}}}else{l.output(o,'The parameter "newMode" in the function changeMode(newMode) is empty or incorrect, please check.');return}document.body.style.overflow="auto";switch(o.mode){case"view":break;case"edit":if(o.originalMode=="view"){o.isFitWindow=true}o.toolbar.width=0;o.toolbar.height=0;o.scrollbar.width=0;o.scrollbar.height=0;o.canvasDIV.width=o.width-o.scrollbar.width-2;o.canvasDIV.height=o.height-o.toolbar.height-2;break;case"editor_out":document.body.style.overflow="hidden";case"editor":if(o.toolbar.filled){o.toolbar.filled=false}o.toolbar.width=o.width-2;o.toolbar.height=Math.floor(o.height/20<20?20:o.height/20);o.scrollbar.width=0;o.scrollbar.height=0;o.canvasDIV.width=o.width-o.scrollbar.width-2;o.canvasDIV.height=o.height-o.toolbar.height-2;break;case"fullscreen":if(o.toolbar.filled){o.toolbar.filled=false}document.body.style.overflow="hidden";o.toolbar.width=screen.width;o.toolbar.height=Math.floor(screen.height/20<20?20:screen.height/20);o.scrollbar.width=0;o.scrollbar.height=0;o.canvasDIV.width=screen.width;o.canvasDIV.height=screen.height;break;default:break}this.updateEditor()};d.prototype.updateEditor=function(){var s=this;l.output(s,'Editor is under mode "'+s.mode+'"');if(s.toolbar.self){if(!s.bShow){return}if(s.toolbar.width+s.toolbar.height==0){l.addClass(s.toolbar.self,"notdisplayed");if(DynamLib.env.bFirefox){s.canvasDIV.upperCanvas.self.style.top="0"}}else{if(DynamLib.env.bFirefox){if(s.toolbar.height!=0&&s.mode!="fullscreen"){s.canvasDIV.upperCanvas.self.style.top=s.toolbar.height+"px"}else{s.canvasDIV.upperCanvas.self.style.top="0"}}s.toolbar.self.style.width=s.toolbar.width+"px";s.toolbar.self.style.height=s.toolbar.height+"px";if(!s.toolbar.filled){s.toolbar.filled=true;while(s.toolbar.self.firstChild){s.toolbar.self.removeChild(s.toolbar.self.firstChild)}s.toolbar.self.appendChild(l.getToolBar(s,s.toolbar.width,s.toolbar.height));if(s.Image.changed){document.getElementsByClassName("Class_D_DWT_Editor_Buttons_save")[0].style.display="";document.getElementsByClassName("Class_D_DWT_Editor_Buttons_restore")[0].style.display=""}if(s.mode=="editor"&&document.getElementsByClassName("Class_D_DWT_Editor_Buttons_fullscreen")[0]){document.getElementsByClassName("Class_D_DWT_Editor_Buttons_fullscreen")[0].style.display="none"}else{document.getElementsByClassName("Class_D_DWT_Editor_Buttons_fullscreen")[0].style.display=""}}if(s.mode=="fullscreen"){l.addClass(s.toolbar.self,"notdisplayed")}else{l.removeClass(s.toolbar.self,"notdisplayed");l.removeClass(s.toolbar.self,"overlay")}}if(s.scrollbar.width+s.scrollbar.height==0){l.addClass(s.scrollbar.self,"notdisplayed")}else{s.scrollbar.self.style.width=s.scrollbar.width+"px";s.scrollbar.self.style.height=s.scrollbar.height+"px";l.removeClass(s.scrollbar.self,"notdisplayed");s.restoreCanvas(s.scrollbar.Canvas.ctx,s.scrollbar.width,s.scrollbar.height)}s.canvasDIV.self.style.width=s.canvasDIV.width+"px";s.canvasDIV.self.style.height=s.canvasDIV.height+"px";s.restoreCanvas(s.canvasDIV.baseCanvas.ctx,s.canvasDIV.width,s.canvasDIV.height);s.restoreCanvas(s.canvasDIV.upperCanvas.ctx,s.canvasDIV.width,s.canvasDIV.height);s.updateMode()}else{var o=document.createElement("div");o.id="singleImgViewToolBar";o.style.width=s.toolbar.width+"px";o.style.height=s.toolbar.height+"px";var p=document.createElement("div");p.id="imageViewer";p.style.width=s.canvasDIV.width+"px";p.style.height=s.canvasDIV.height+"px";p.className="floatLeft";var r=document.createElement("canvas");if(DynamLib.env.bFirefox){r.style.left="0";r.style.top="0"}r.id="imageViewerCursor";var m=document.createElement("canvas");m.id="imageViewerCanvas";p.appendChild(r);p.appendChild(m);var q=document.createElement("div");q.id="imageViewerScrollBar";q.style.width=s.scrollbar.width+"px";q.style.height=s.scrollbar.height+"px";q.className="floatRight";var n=document.createElement("canvas");n.id="viewerScrollBar";q.appendChild(n);s.UIEditor.setStyles({width:(s.width-2)+"px",height:(s.height-2)+"px"});s.UIEditor.append(o);s.UIEditor.append(p);s.UIEditor.append(q);s.UIEditor.attr("class","noPaddingnoMarginInside thinborder");s.toolbar.self=document.getElementById("singleImgViewToolBar");s.scrollbar.self=document.getElementById("imageViewerScrollBar");s.scrollbar.Canvas.self=document.getElementById("viewerScrollBar");s.scrollbar.Canvas.ctx=s.scrollbar.Canvas.self.getContext("2d");s.canvasDIV.self=document.getElementById("imageViewer");s.canvasDIV.self.style.backgroundColor=s.canvasDIV.baseCanvas.backgroundColor;s.canvasDIV.baseCanvas.self=document.getElementById("imageViewerCanvas");s.canvasDIV.baseCanvas.ctx=s.canvasDIV.baseCanvas.self.getContext("2d");s.canvasDIV.upperCanvas.self=document.getElementById("imageViewerCursor");s.canvasDIV.upperCanvas.ctx=s.canvasDIV.upperCanvas.self.getContext("2d");s.bindEventsToCanvas();s.updateEditor()}};d.prototype.bindEventsToCanvas=function(){var n=this,m;DynamLib.addEventListener(n.canvasDIV.self,"mousedown",function(p){n.canvasDIV.upperCanvas.drawingRect=true;var o=getOffset(p);if(DynamLib.env.bFirefox&&n.mode!="fullscreen"&&n.mode!="editor_out"){o.x+=window.pageXOffset;o.y+=window.pageYOffset}n.canvasDIV.upperCanvas.mouse_zero_x=o.x;n.canvasDIV.upperCanvas.mouse_zero_y=o.y;if(n.canvasDIV.upperCanvas.mouse_zero_x-parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.x)<0){n.canvasDIV.upperCanvas.mouse_zero_x=parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.x)}if(n.canvasDIV.upperCanvas.mouse_zero_y-parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.y)<0){n.canvasDIV.upperCanvas.mouse_zero_y=parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.y)}if(n.canvasDIV.upperCanvas.mouse_zero_x+parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.x)>n.canvasDIV.upperCanvas.ctx.canvas.width){n.canvasDIV.upperCanvas.mouse_zero_x=parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.x)+n.canvasDIV.baseCanvas.drawArea.width}if(n.canvasDIV.upperCanvas.mouse_zero_y+parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.y)>n.canvasDIV.upperCanvas.ctx.canvas.height){n.canvasDIV.upperCanvas.mouse_zero_y=parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.y)+n.canvasDIV.baseCanvas.drawArea.height}});DynamLib.addEventListener(n.canvasDIV.self,"mousemove",function(s){var p=getOffset(s);if(DynamLib.env.bFirefox&&n.mode!="fullscreen"&&n.mode!="editor_out"){p.x+=window.pageXOffset;p.y+=window.pageYOffset}n.canvasDIV.upperCanvas.mouse_x=p.x;n.canvasDIV.upperCanvas.mouse_y=p.y;if(n.mode=="fullscreen"){if(p.y<10&&p.y>5){l.addClass(n.toolbar.self,"overlay");l.removeClass(n.toolbar.self,"notdisplayed")}else{l.addClass(n.toolbar.self,"notdisplayed");l.removeClass(n.toolbar.self,"overlay")}}if(n.canvasDIV.upperCanvas.drawingRect){if(n.canvasDIV.upperCanvas.mouse_x-parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.x)<0){n.canvasDIV.upperCanvas.mouse_x=parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.x)}if(n.canvasDIV.upperCanvas.mouse_y-parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.y)<0){n.canvasDIV.upperCanvas.mouse_y=parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.y)}if(n.canvasDIV.upperCanvas.mouse_x+parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.x)>n.canvasDIV.upperCanvas.ctx.canvas.width){n.canvasDIV.upperCanvas.mouse_x=parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.x)+n.canvasDIV.baseCanvas.drawArea.width}if(n.canvasDIV.upperCanvas.mouse_y+parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.y)>n.canvasDIV.upperCanvas.ctx.canvas.height){n.canvasDIV.upperCanvas.mouse_y=parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.y)+n.canvasDIV.baseCanvas.drawArea.height}n.fire("onMouseMove",{x:n.canvasDIV.upperCanvas.mouse_x,y:n.canvasDIV.upperCanvas.mouse_y});n.canvasDIV.selectedCanvasArea.left=n.canvasDIV.upperCanvas.mouse_zero_x;n.canvasDIV.selectedCanvasArea.right=n.canvasDIV.upperCanvas.mouse_x;n.canvasDIV.selectedCanvasArea.top=n.canvasDIV.upperCanvas.mouse_zero_y;n.canvasDIV.selectedCanvasArea.bottom=n.canvasDIV.upperCanvas.mouse_y;if(n.canvasDIV.upperCanvas.MouseShape){if(n.canvasDIV.overflow){n.canvasDIV.self.scrollLeft=n.canvasDIV.scrollLeft_zero+(n.canvasDIV.selectedCanvasArea.left-n.canvasDIV.selectedCanvasArea.right)/n.zoom;n.canvasDIV.self.scrollTop=n.canvasDIV.scrollTop_zero+(n.canvasDIV.selectedCanvasArea.top-n.canvasDIV.selectedCanvasArea.bottom)/n.zoom}}else{var q,u,v,o;q=(n.canvasDIV.self.scrollLeft+n.canvasDIV.selectedCanvasArea.left-parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.x));u=(n.canvasDIV.self.scrollTop+n.canvasDIV.selectedCanvasArea.top-parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.y));v=(n.canvasDIV.self.scrollLeft+n.canvasDIV.selectedCanvasArea.right-parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.x));o=(n.canvasDIV.self.scrollTop+n.canvasDIV.selectedCanvasArea.bottom-parseInt(n.canvasDIV.baseCanvas.drawArea.baseCoordinates.y));n.SetSelectedImageArea(q/n.zoom,u/n.zoom,v/n.zoom,o/n.zoom)}}});DynamLib.addEventListener(n.canvasDIV.self,"mouseout",function(o){n.canvasDIV.upperCanvas.drawingRect=false});DynamLib.addEventListener(n.canvasDIV.self,"mouseup",function(v){n.canvasDIV.upperCanvas.drawingRect=false;n.canvasDIV.scrollLeft_zero=n.canvasDIV.self.scrollLeft;n.canvasDIV.scrollTop_zero=n.canvasDIV.self.scrollTop;var w=getOffset(v);if(DynamLib.env.bFirefox&&n.mode!="fullscreen"&&n.mode!="editor_out"){w.x+=window.pageXOffset;w.y+=window.pageYOffset}n.canvasDIV.upperCanvas.mouse_x=w.x;n.canvasDIV.upperCanvas.mouse_y=w.y;var u=n.canvasDIV.upperCanvas.mouse_x;var s=n.canvasDIV.upperCanvas.mouse_y;var r=n.canvasDIV.selectedCanvasArea.right-n.canvasDIV.selectedCanvasArea.left;var p=n.canvasDIV.selectedCanvasArea.bottom-n.canvasDIV.selectedCanvasArea.top;if(Math.abs(r)+Math.abs(p)<10){n.SetSelectedImageArea(0,0,0,0);return}if(r<0){var z=n.canvasDIV.selectedCanvasArea.right;var o=n.canvasDIV.selectedCanvasArea.left}else{var z=n.canvasDIV.selectedCanvasArea.left;var o=n.canvasDIV.selectedCanvasArea.right}if(p<0){var q=n.canvasDIV.selectedCanvasArea.bottom;var t=n.canvasDIV.selectedCanvasArea.top}else{var q=n.canvasDIV.selectedCanvasArea.top;var t=n.canvasDIV.selectedCanvasArea.bottom}if(!(u<z)&&!(u>o)&&!(s<q)&&!(s>t)){}else{n.SetSelectedImageArea(0,0,0,0)}});DynamLib.addEventListener(n.canvasDIV.self,"dblclick",function(o){n.canvasDIV.upperCanvas.mouse_x=(parseInt(o.pageX)-parseInt(n.canvasDIV.upperCanvas.self.offsetLeft));n.canvasDIV.upperCanvas.mouse_y=(parseInt(o.pageY)-parseInt(n.canvasDIV.upperCanvas.self.offsetTop))})};d.prototype.SetSelectedImageArea=function(p,x,y,n){var s=this,v,o;s.canvasDIV.selectedImageArea.left=p;s.canvasDIV.selectedImageArea.top=x;s.canvasDIV.selectedImageArea.right=y;s.canvasDIV.selectedImageArea.bottom=n;v=s.canvasDIV.selectedCanvasArea.right-s.canvasDIV.selectedCanvasArea.left;o=s.canvasDIV.selectedCanvasArea.bottom-s.canvasDIV.selectedCanvasArea.top;if(p-n==0||x-n==0){v=0;o=0}s.restoreCanvas(s.canvasDIV.upperCanvas.ctx,s.canvasDIV.upperCanvas.ctx.canvas.width,s.canvasDIV.upperCanvas.ctx.canvas.height);if(Math.abs(v)+Math.abs(o)>10){if(document.getElementsByClassName("Class_D_DWT_Editor_Buttons_crop")[0]){var u=document.getElementsByClassName("Class_D_DWT_Editor_Buttons_crop")[0].src;u=u.replace("crop_grey.","crop.");document.getElementsByClassName("Class_D_DWT_Editor_Buttons_crop")[0].src=u;document.getElementsByClassName("Class_D_DWT_Editor_Buttons_crop")[0].style.cursor="pointer"}s.canvasDIV.upperCanvas.ctx.dashedLineRect(s.canvasDIV.selectedCanvasArea.left,s.canvasDIV.selectedCanvasArea.top,v,o);var q,z,m,w;if(y<p&&n<x){q=y;z=n;m=p;w=x}else{m=y;w=n;q=p;z=x}s.fire("onImageAreaSelected",{cIndex:s.cIndex,left:q,top:z,right:m,bottom:w})}else{if(document.getElementsByClassName("Class_D_DWT_Editor_Buttons_crop")[0]){var u=document.getElementsByClassName("Class_D_DWT_Editor_Buttons_crop")[0].src;u=u.replace("crop.","crop_grey.");document.getElementsByClassName("Class_D_DWT_Editor_Buttons_crop")[0].src=u;document.getElementsByClassName("Class_D_DWT_Editor_Buttons_crop")[0].style.cursor="auto"}s.fire("onImageAreaDeSelected",s.cIndex)}};d.prototype.exitFullScreen=function(){var m=this;if(m.isfullscreen){m.isfullscreen=false;if(document.exitFullscreen){document.exitFullscreen()}else{if(document.msExitFullscreen){document.msExitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitExitFullscreen){document.webkitExitFullscreen()}}}}if(typeof m.originalModeBeforeFullScreen==="undefined"){m.originalModeBeforeFullScreen="view"}m.changeMode(m.originalModeBeforeFullScreen)}};d.prototype.fullscreen=function(){var n=this;if(!n.bShow||n.mode=="fullscreen"||n.mode=="editor"){return}n.originalModeBeforeFullScreen=n.mode;n.isfullscreen=true;var m=n.canvasDIV.self.parentElement;if(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement){if(m.requestFullscreen){m.requestFullscreen()}else{if(m.msRequestFullscreen){m.msRequestFullscreen()}else{if(m.mozRequestFullScreen){m.mozRequestFullScreen()}else{if(m.webkitRequestFullscreen){m.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}}}}}else{if(document.exitFullscreen){document.exitFullscreen()}else{if(document.msExitFullscreen){document.msExitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitExitFullscreen){document.webkitExitFullscreen()}}}}}n.changeMode("fullscreen")};d.prototype.previous_btn=function(){var n=this,m;if(document.getElementsByClassName("Class_D_DWT_Editor_Buttons_previous")[0]){m=document.getElementsByClassName("Class_D_DWT_Editor_Buttons_previous")[0].src;if(m.indexOf("grey")!=-1){return}else{n.previous()}}};d.prototype.previous=function(){var n=this;if(n.Image.changed){if(confirm("You have changed the image, do you want to keep the change(s)?")){n.SaveImage()}else{n.RestoreImage()}}l.output(n,"previous");if(n.cIndex<0){return}else{if(n.cIndex==0){return}}n.cIndex--;var m;if(n.cIndex==0){if(document.getElementsByClassName("Class_D_DWT_Editor_Buttons_previous")[0]){m=document.getElementsByClassName("Class_D_DWT_Editor_Buttons_previous")[0].src;m=m.replace("previous.","previous_grey.");document.getElementsByClassName("Class_D_DWT_Editor_Buttons_previous")[0].src=m;document.getElementsByClassName("Class_D_DWT_Editor_Buttons_previous")[0].style.cursor="auto";if(n.totalImagesCount>1){m=document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0].src;m=m.replace("next_grey.","next.");document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0].src=m;document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0].style.cursor="pointer"}}}n.refresh();n.fire("onRefreshUI",n.cIndex)};d.prototype.next_btn=function(){var n=this,m;if(document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0]){m=document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0].src;if(m.indexOf("grey")!=-1){return}else{n.next()}}};d.prototype.next=function(){var n=this;if(n.Image.changed){if(confirm("You have changed the image, do you want to keep the change(s)?")){n.SaveImage()}else{n.RestoreImage()}}l.output(n,"next");if(n.cIndex<0){return}else{if(n.cIndex==n.totalImagesCount-1){return}}n.cIndex++;if(n.cIndex==n.totalImagesCount-1){if(document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0]){var m=document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0].src;m=m.replace("next.","next_grey.");document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0].src=m;document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0].style.cursor="auto";if(n.totalImagesCount>1){m=document.getElementsByClassName("Class_D_DWT_Editor_Buttons_previous")[0].src;m=m.replace("previous_grey.","previous.");document.getElementsByClassName("Class_D_DWT_Editor_Buttons_previous")[0].src=m;document.getElementsByClassName("Class_D_DWT_Editor_Buttons_previous")[0].style.cursor="pointer"}}}n.refresh();n.fire("onRefreshUI",n.cIndex)};d.prototype.show=function(){var m=this;m.bShow=true;m.UIEditor.style("display","");return true};d.prototype.hide=function(){var m=this;m.bShow=false;m.mode="view";m.originalMode="view";m.UIEditor.style("display","none");return true};d.prototype.clear=function(){var m=this;m.cIndex=-1;m.refresh()};d.prototype.refresh=function(o,m,n){var p=this;if(typeof o==="undefined"){o=p.cIndex}else{o=parseInt(o);p.cIndex=o;if(m){p.totalImagesCount=m}}if(document.getElementsByClassName("Class_D_DWT_Editor_Buttons_save")[0]){if(n){if(p.mode=="editor"||p.mode=="editor_out"){p.Image.changed=true}document.getElementsByClassName("Class_D_DWT_Editor_Buttons_save")[0].style.display="";document.getElementsByClassName("Class_D_DWT_Editor_Buttons_restore")[0].style.display=""}}p.SetSelectedImageArea(0,0,0,0);if(p.cIndex==-1){p.Image.url=p.defaultImageUrl;p.Image.baseUrl=p.defaultImageUrl;p.Image.height=590;p.Image.width=480;p.Image.imgAspectRatio=590/480;if(p.bShow){p.updateMode()}}else{p.Image.baseUrl=getServerImageBaseUrl(p.DWObject,o);p.Image.url=p.__getUrlByAct(0);p.Image.height=0;p.Image.width=0;if(p.bShow){p.__refreshImageSize(function(r){if(parseInt(r.Image.width*r.zoom)>k||parseInt(r.Image.height*r.zoom)>k){l.output(r,"You have reached the limit of the canvas.");var q=r.Image.width>r.Image.height?r.Image.width:r.Image.height;r.zoom=k/q}r.updateMode()})}}};d.prototype.updateScrollBar=function(){var m=this;l.output(m,"updateScrollBar");m.scrollbar.Canvas.ctx.clearRect(0,0,m.scrollbar.width,m.scrollbar.height);m.scrollbar.glider.height=m.scrollbar.height/m.totalImagesCount;m.scrollbar.Canvas.ctx.fillStyle=m.scrollbar.glider.color;m.scrollbar.Canvas.ctx.fillRect(0,m.cIndex*m.scrollbar.glider.height,m.scrollbar.width,m.scrollbar.glider.height)};d.prototype.updateMode=function(){var o=this,n;l.output(o,"updateMode");if(o.totalImagesCount>1){if(document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0]){if(o.cIndex==o.totalImagesCount-1){n=document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0].src;n=n.replace("next.","next_grey.");document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0].src=n;document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0].style.cursor="auto"}else{n=document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0].src;n=n.replace("next_grey.","next.");document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0].src=n;document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0].style.cursor="pointer"}if(o.cIndex==0){n=document.getElementsByClassName("Class_D_DWT_Editor_Buttons_previous")[0].src;n=n.replace("previous.","previous_grey.");document.getElementsByClassName("Class_D_DWT_Editor_Buttons_previous")[0].src=n;document.getElementsByClassName("Class_D_DWT_Editor_Buttons_previous")[0].style.cursor="auto"}else{n=document.getElementsByClassName("Class_D_DWT_Editor_Buttons_previous")[0].src;n=n.replace("previous_grey.","previous.");document.getElementsByClassName("Class_D_DWT_Editor_Buttons_previous")[0].src=n;document.getElementsByClassName("Class_D_DWT_Editor_Buttons_previous")[0].style.cursor="pointer"}}}else{if(document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0]){n=document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0].src;n=n.replace("next.","next_grey.");document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0].src=n;document.getElementsByClassName("Class_D_DWT_Editor_Buttons_next")[0].style.cursor="auto";n=document.getElementsByClassName("Class_D_DWT_Editor_Buttons_previous")[0].src;n=n.replace("previous.","previous_grey.");document.getElementsByClassName("Class_D_DWT_Editor_Buttons_previous")[0].src=n;document.getElementsByClassName("Class_D_DWT_Editor_Buttons_previous")[0].style.cursor="auto"}}switch(o.mode){case"view":break;default:o.setMouseShape(o.canvasDIV.upperCanvas.MouseShape);if(o.cIndex==-1){o.drawImageOnBaseCanvas();break}o.SetSelectedImageArea(0,0,0,0);var m=function(p){if(p.mode=="edit"&&o.isFitWindow){p.FitsWindowSize()}else{p.canvasDIV.baseCanvas.drawArea.width=p.Image.width*p.zoom;p.canvasDIV.baseCanvas.drawArea.height=p.Image.height*p.zoom;p.drawImageOnBaseCanvas()}};if(o.Image.width==0||o.Image.height==0){o.__refreshImageSize(m)}else{m(o)}break}};d.prototype.print=function(){var o=this,n=o.cIndex,m;if(n<0){return}m=o.Image.url;l.print(o,m)};d.prototype.getMousePosition=function(){var n=this;l.output(n,"getMousePosition");var m={x:n.canvasDIV.upperCanvas.mouse_x,y:n.canvasDIV.upperCanvas.mouse_y};return m};d.prototype.restoreCanvas=function(n,m,o){var p=this;n.canvas.width=m;n.canvas.height=o};d.prototype.drawImageOnBaseCanvas=function(){var r=this,o=false,m=false,q=0,p=0;r.restoreCanvas(r.canvasDIV.baseCanvas.ctx,r.canvasDIV.width,r.canvasDIV.height);if(r.cIndex==-1){l.output(r,"no image to draw");return}r.canvasDIV.baseCanvas.drawArea.baseCoordinates.x=0;r.canvasDIV.baseCanvas.drawArea.baseCoordinates.y=0;l.removeClass(r.canvasDIV.self,"allowOverFlow");if(r.canvasDIV.baseCanvas.drawArea.width>r.canvasDIV.width||r.canvasDIV.baseCanvas.drawArea.height>r.canvasDIV.height){r.canvasDIV.overflow=true}else{r.canvasDIV.overflow=false}if(r.canvasDIV.baseCanvas.drawArea.width>r.canvasDIV.width){o=true;l.addClass(r.canvasDIV.self,"allowOverFlowX");r.canvasDIV.baseCanvas.ctx.canvas.width=r.canvasDIV.baseCanvas.drawArea.width;if(r.canvasDIV.baseCanvas.drawArea.height<=r.canvasDIV.height){p=r.canvasDIV.self.offsetHeight-r.canvasDIV.self.clientHeight;if(r.canvasDIV.baseCanvas.drawArea.height==r.canvasDIV.height){r.canvasDIV.baseCanvas.drawArea.height=r.canvasDIV.height-p;r.canvasDIV.baseCanvas.drawArea.width=parseInt(r.canvasDIV.baseCanvas.drawArea.height/r.Image.imgAspectRatio)}r.restoreCanvas(r.canvasDIV.baseCanvas.ctx,r.canvasDIV.baseCanvas.drawArea.width,r.canvasDIV.height-p);r.restoreCanvas(r.canvasDIV.upperCanvas.ctx,r.canvasDIV.width,r.canvasDIV.height-p)}}else{l.removeClass(r.canvasDIV.self,"allowOverFlowX")}if(r.canvasDIV.baseCanvas.drawArea.height>r.canvasDIV.height){m=true;l.addClass(r.canvasDIV.self,"allowOverFlowY");r.canvasDIV.baseCanvas.ctx.canvas.height=r.canvasDIV.baseCanvas.drawArea.height;if(r.canvasDIV.baseCanvas.drawArea.width<=r.canvasDIV.width){q=r.canvasDIV.self.offsetWidth-r.canvasDIV.self.clientWidth;if(r.canvasDIV.baseCanvas.drawArea.width==r.canvasDIV.width){r.canvasDIV.baseCanvas.drawArea.width=r.canvasDIV.width-q;r.canvasDIV.baseCanvas.drawArea.height=parseInt(r.canvasDIV.baseCanvas.drawArea.width*r.Image.imgAspectRatio)}r.restoreCanvas(r.canvasDIV.baseCanvas.ctx,r.canvasDIV.width-q,r.canvasDIV.baseCanvas.drawArea.height);r.restoreCanvas(r.canvasDIV.upperCanvas.ctx,r.canvasDIV.width-q,r.canvasDIV.height)}}else{l.removeClass(r.canvasDIV.self,"allowOverFlowY")}if(o&&m){l.removeClass(r.canvasDIV.self,"allowOverFlowX");l.removeClass(r.canvasDIV.self,"allowOverFlowY");l.addClass(r.canvasDIV.self,"allowOverFlow");q=r.canvasDIV.self.offsetWidth-r.canvasDIV.self.clientWidth;p=r.canvasDIV.self.offsetHeight-r.canvasDIV.self.clientHeight;r.restoreCanvas(r.canvasDIV.upperCanvas.ctx,r.canvasDIV.width-q,r.canvasDIV.height-p);r.restoreCanvas(r.canvasDIV.baseCanvas.ctx,r.canvasDIV.baseCanvas.drawArea.width,r.canvasDIV.baseCanvas.drawArea.height)}if(!(o||m)){l.removeClass(r.canvasDIV.self,"allowOverFlowX");l.removeClass(r.canvasDIV.self,"allowOverFlowY");r.restoreCanvas(r.canvasDIV.baseCanvas.ctx,r.canvasDIV.width,r.canvasDIV.height);r.restoreCanvas(r.canvasDIV.upperCanvas.ctx,r.canvasDIV.width,r.canvasDIV.height)}if(r.canvasDIV.width-r.canvasDIV.baseCanvas.drawArea.width-q>0){r.canvasDIV.baseCanvas.drawArea.baseCoordinates.x=(r.canvasDIV.width-r.canvasDIV.baseCanvas.drawArea.width-q)/2}if(r.canvasDIV.height-r.canvasDIV.baseCanvas.drawArea.height-p>0){r.canvasDIV.baseCanvas.drawArea.baseCoordinates.y=(r.canvasDIV.height-r.canvasDIV.baseCanvas.drawArea.height-p)/2}var n=new Image();n.onload=function(){r.canvasDIV.baseCanvas.ctx.fillStyle=r.canvasDIV.baseCanvas.backgroundColor;r.canvasDIV.baseCanvas.ctx.fillRect(0,0,r.canvasDIV.baseCanvas.ctx.canvas.width,r.canvasDIV.baseCanvas.ctx.canvas.height);r.canvasDIV.baseCanvas.ctx.drawImage(n,r.canvasDIV.baseCanvas.drawArea.baseCoordinates.x,r.canvasDIV.baseCanvas.drawArea.baseCoordinates.y,r.canvasDIV.baseCanvas.drawArea.width,r.canvasDIV.baseCanvas.drawArea.height)};n.src=r.Image.url};d.prototype.StrechMode=function(){var n=this,m;m=function(o){o.canvasDIV.baseCanvas.drawArea.width=parseInt(o.canvasDIV.baseCanvas.ctx.canvas.width);o.canvasDIV.baseCanvas.drawArea.height=parseInt(o.canvasDIV.baseCanvas.ctx.canvas.height);if(o.aspectRatio>o.Image.imgAspectRatio){o.zoom=o.canvasDIV.baseCanvas.drawArea.width/o.Image.width}else{o.zoom=o.canvasDIV.baseCanvas.drawArea.height/o.Image.height}o.drawImageOnBaseCanvas();o.isFitWindow=true};if(n.Image.width==0||n.Image.height==0){n.__refreshImageSize(m)}else{m(n)}};d.prototype.FitsWindowSize=function(){var n=this,m;m=function(o){o.isFitWindow=true;if(o.aspectRatio<o.Image.imgAspectRatio){o.FitsWindowHeight(true)}else{o.FitsWindowWidth(true)}};if(n.Image.width==0||n.Image.height==0){n.__refreshImageSize(m)}else{m(n)}};d.prototype.FitsWindowWidth=function(m){var o=this,n;if(typeof m==="undefined"||!m){if(o.mode=="view"){l.output(o,"Change to edit mode before using this function. Current modee is  "+o.mode);return}}l.output(o,"FitsWindowWidth");n=function(p){p.canvasDIV.baseCanvas.drawArea.width=p.canvasDIV.width;p.canvasDIV.baseCanvas.drawArea.height=parseInt(p.canvasDIV.baseCanvas.drawArea.width*p.Image.imgAspectRatio);if(p.canvasDIV.baseCanvas.drawArea.height>p.canvasDIV.height){p.isFitWindow=false}p.zoom=p.canvasDIV.baseCanvas.drawArea.width/p.Image.width;p.drawImageOnBaseCanvas()};if(o.Image.width==0||o.Image.height==0){o.__refreshImageSize(n)}else{n(o)}};d.prototype.FitsWindowHeight=function(m){var o=this,n;if(typeof m==="undefined"||!m){if(o.mode=="view"){l.output(o,"Change to edit mode before using this function. Current modee is  "+o.mode);return}}n=function(p){p.canvasDIV.baseCanvas.drawArea.height=p.canvasDIV.height;p.canvasDIV.baseCanvas.drawArea.width=p.canvasDIV.baseCanvas.drawArea.height/p.Image.imgAspectRatio;if(p.canvasDIV.baseCanvas.drawArea.width>p.canvasDIV.width){p.isFitWindow=false}p.zoom=p.canvasDIV.baseCanvas.drawArea.height/p.Image.height;p.drawImageOnBaseCanvas()};if(o.Image.width==0||o.Image.height==0){o.__refreshImageSize(n)}else{n(o)}};d.prototype.ZoomIn=function(){var n=this,m;if(n.mode!="view"){m=function(p){var o=(Math.floor(p.zoom*100*p.zoomInStep)+1);if(1<o&&o<2501){if(parseInt(p.Image.width*p.zoom)>k||parseInt(p.Image.height*p.zoom)>k){l.output(p,"You have reached the limit for zooming in")}else{p.zoom=o/100;p.canvasDIV.baseCanvas.drawArea.width=parseInt(p.Image.width*p.zoom);p.canvasDIV.baseCanvas.drawArea.height=parseInt(p.Image.height*p.zoom)}}else{l.output(p,"You have reached the limit for zooming in");alert("You have reached the limit for zooming in")}p.drawImageOnBaseCanvas();p.isFitWindow=false};if(n.Image.width==0||n.Image.height==0){n.__refreshImageSize(m)}else{m(n)}}else{l.output(n,"Zoom is not allowed under the mode "+n.mode)}};d.prototype.ZoomOut=function(){var n=this,m;if(n.mode!="view"){m=function(p){var o=(Math.floor(p.zoom*100*p.zoomOutStep)-1);if(1<o&&o<6501){p.zoom=o/100;p.canvasDIV.baseCanvas.drawArea.width=parseInt(p.Image.width*p.zoom);p.canvasDIV.baseCanvas.drawArea.height=parseInt(p.Image.height*p.zoom)}else{l.output(p,"You have reached the limit for zooming out")}p.drawImageOnBaseCanvas();p.isFitWindow=false};if(n.Image.width==0||n.Image.height==0){n.__refreshImageSize(m)}else{m(n)}}else{l.output(n,"Zoom is not allowed under the mode "+n.mode)}};d.prototype.OriginalSize=function(){var n=this,m;if(n.mode!="view"){m=function(o){o.zoom=1;o.canvasDIV.baseCanvas.drawArea.width=parseInt(o.Image.width);o.canvasDIV.baseCanvas.drawArea.height=parseInt(o.Image.height);o.drawImageOnBaseCanvas();o.isFitWindow=false};if(n.Image.width==0||n.Image.height==0){n.__refreshImageSize(m)}else{m(n)}}else{l.output(n,"Change to -1*-1 view mode before using this function. Current modee is  "+n.mode)}};d.prototype.CopyToClipboard=function(){var m=this;m.DWObject.CopyToClipboard(m.cIndex)};d.prototype.RestoreImage=function(){var n=this,m;if(n.cIndex==-1){n.refresh();return}n.SetSelectedImageArea(0,0,0,0);m=n.__getUrlByAct(1);n.Image.url=m;n.Image.height=0;n.Image.width=0;n.__refreshImageSize(function(o){n.Image.changed=false;o.fire("onRefreshUI",o.cIndex);if(document.getElementsByClassName("Class_D_DWT_Editor_Buttons_save")[0]){document.getElementsByClassName("Class_D_DWT_Editor_Buttons_save")[0].style.display="none";document.getElementsByClassName("Class_D_DWT_Editor_Buttons_restore")[0].style.display="none"}if(o.bShow){o.updateMode()}o.Image.url=o.__getUrlByAct(0)})};d.prototype.SaveImage=function(){var n=this,m;if(n.cIndex==-1){n.refresh();return}if(!n.Image.changed){alert("You have not changed the current image");return}n.SetSelectedImageArea(0,0,0,0);m=n.__getUrlByAct(2);n.Image.url=m;n.Image.height=0;n.Image.width=0;n.__refreshImageSize(function(o){n.Image.changed=false;o.fire("onRefreshUI",o.cIndex);if(document.getElementsByClassName("Class_D_DWT_Editor_Buttons_save")[0]){document.getElementsByClassName("Class_D_DWT_Editor_Buttons_save")[0].style.display="none";document.getElementsByClassName("Class_D_DWT_Editor_Buttons_restore")[0].style.display="none"}if(o.bShow){o.updateMode()}o.Image.url=o.__getUrlByAct(0)})};d.prototype.__getUrlByAct=function(m){var p=this,n=p.Image.baseUrl,o=[n];if(m){o.push("&act=");o.push(m)}o.push("&ticks=");o.push(Math.floor(Math.random()*100000+1));return o.join("")};d.prototype.Erase=function(p,o,n,m){var q=this;l.output(q,"Erase");if(typeof p==="undefined"||typeof o==="undefined"||typeof n==="undefined"||typeof m==="undefined"){l.output(q,"Not enough paramters")}else{q.canvasDIV.selectedImageArea.left=parseInt(p)?parseInt(p):0;q.canvasDIV.selectedImageArea.top=parseInt(o)?parseInt(o):0;q.canvasDIV.selectedImageArea.right=parseInt(n)?parseInt(n):0;q.canvasDIV.selectedImageArea.bottom=parseInt(m)?parseInt(m):0}if(q.canvasDIV.selectedImageArea.left-q.canvasDIV.selectedImageArea.right!=0&&q.canvasDIV.selectedImageArea.top-q.canvasDIV.selectedImageArea.bottom!=0){q.DWObject.Erase(q.cIndex,q.canvasDIV.selectedImageArea.left,q.canvasDIV.selectedImageArea.top,q.canvasDIV.selectedImageArea.right,q.canvasDIV.selectedImageArea.bottom)}else{l.output(q,"No area selected for erasing");return}};d.prototype.Rotate=function(m,n){var o=this;if(typeof m==="undefined"||typeof n==="undefined"){alert("Not enough paramters")}else{o.DWObject.Rotate(o.cIndex,m,n)}};d.prototype.RotateEx=function(m,o,n){var p=this;if(typeof m==="undefined"||typeof o==="undefined"||typeof n==="undefined"){alert("Not enough paramters")}else{p.DWObject.RotateEx(p.cIndex,m,o,n)}};d.prototype.RotateLeft=function(){var m=this;m.DWObject.RotateLeft(m.cIndex)};d.prototype.RotateAnyAngle=function(){var n=this;var m=prompt("Please input the angle to rotate","45");if(m){m=parseInt(m);if(m&&typeof m==="number"&&m!=0){n.RotateEx(m,false,1)}else{alert("Wrong input")}}else{l.output(n,"User Cancelled")}};d.prototype.RotateRight=function(){var m=this;m.DWObject.RotateRight(m.cIndex)};d.prototype.Deskew=function(){var m=this;m.RotateEx(m.DWObject.GetSkewAngle(m.cIndex),true,1)};d.prototype.Flip=function(){var m=this;m.DWObject.Flip(m.cIndex)};d.prototype.Mirror=function(){var m=this;m.DWObject.Mirror(m.cIndex)};d.prototype.ChangeImageSize=function(n,m,o){var p=this;p.DWObject.ChangeImageSize(p.cIndex,n,m,o)};d.prototype.ChangeImageSizeGetinput=function(){var p=this;var n=prompt("Please input the width and height separated with comma(,)",p.Image.width+","+p.Image.height);if(n){n=n.split(",");if(n.length!=2){l.output(p,"Wrong input");return}else{var m=parseInt(n[0]);var o=parseInt(n[1]);if(m&&o&&typeof m==="number"&&typeof o==="number"){if(m==0||o==0){alert("invalid input, 0 is not allowed");return}else{p.ChangeImageSize(m,o,1)}}else{alert("Wrong input, numbers needed");return}}}else{l.output(p,"User Cancelled")}};d.prototype.Crop_btn=function(){var n=this,m;if(document.getElementsByClassName("Class_D_DWT_Editor_Buttons_crop")[0]){m=document.getElementsByClassName("Class_D_DWT_Editor_Buttons_crop")[0].src;if(m.indexOf("grey")!=-1){return}else{n.Crop()}}};d.prototype.Crop=function(p,o,n,m){var q=this;if(typeof p==="undefined"||typeof o==="undefined"||typeof n==="undefined"||typeof m==="undefined"){l.output(q,"Not enough paramters")}else{q.canvasDIV.selectedImageArea.left=parseInt(p)?parseInt(p):0;q.canvasDIV.selectedImageArea.top=parseInt(o)?parseInt(o):0;q.canvasDIV.selectedImageArea.right=parseInt(n)?parseInt(n):0;q.canvasDIV.selectedImageArea.bottom=parseInt(m)?parseInt(m):0}if(q.canvasDIV.selectedImageArea.left-q.canvasDIV.selectedImageArea.right!=0&&q.canvasDIV.selectedImageArea.top-q.canvasDIV.selectedImageArea.bottom!=0){q.DWObject.Crop(q.cIndex,q.canvasDIV.selectedImageArea.left,q.canvasDIV.selectedImageArea.top,q.canvasDIV.selectedImageArea.right,q.canvasDIV.selectedImageArea.bottom)}else{l.output(q,"No area selected for cropping");return}};d.prototype.CropToClipboard=function(p,o,n,m){var q=this;if(typeof p==="undefined"||typeof o==="undefined"||typeof n==="undefined"||typeof m==="undefined"){l.output(q,"Not enough paramters")}else{q.canvasDIV.selectedImageArea.left=parseInt(p)?parseInt(p):0;q.canvasDIV.selectedImageArea.top=parseInt(o)?parseInt(o):0;q.canvasDIV.selectedImageArea.right=parseInt(n)?parseInt(n):0;q.canvasDIV.selectedImageArea.bottom=parseInt(m)?parseInt(m):0}if(q.canvasDIV.selectedImageArea.left-q.canvasDIV.selectedImageArea.right!=0&&q.canvasDIV.selectedImageArea.top-q.canvasDIV.selectedImageArea.bottom!=0){q.DWObject.CropToClipboard(q.cIndex,q.canvasDIV.selectedImageArea.left,q.canvasDIV.selectedImageArea.top,q.canvasDIV.selectedImageArea.right,q.canvasDIV.selectedImageArea.bottom)}else{l.output(q,"No area selected for cropping");return}};d.prototype.CutFrameToClipboard=function(p,o,n,m){var q=this;if(typeof p==="undefined"||typeof o==="undefined"||typeof n==="undefined"||typeof m==="undefined"){l.output(q,"Not enough paramters")}else{q.canvasDIV.selectedImageArea.left=parseInt(p)?parseInt(p):0;q.canvasDIV.selectedImageArea.top=parseInt(o)?parseInt(o):0;q.canvasDIV.selectedImageArea.right=parseInt(n)?parseInt(n):0;q.canvasDIV.selectedImageArea.bottom=parseInt(m)?parseInt(m):0}if(q.canvasDIV.selectedImageArea.left-q.canvasDIV.selectedImageArea.right!=0&&q.canvasDIV.selectedImageArea.top-q.canvasDIV.selectedImageArea.bottom!=0){q.DWObject.CutFrameToClipboard(q.cIndex,q.canvasDIV.selectedImageArea.left,q.canvasDIV.selectedImageArea.top,q.canvasDIV.selectedImageArea.right,q.canvasDIV.selectedImageArea.bottom)}else{l.output(q,"No area selected for cutting");return}};d.prototype.CutToClipboard=function(){var m=this;m.DWObject.CutToClipboard(m.cIndex)};d.prototype.OverlayRectangle=function(r,q,p,n,m,o){var s=this;l.output(s,"OverlayRectangle")};d.prototype.SetDPI=function(o,p,m,n){var q=this;l.output(q,"SetDPI")};d.prototype.AddText=function(m,t,q,p,r,o,n){var s=this;l.output(s,"AddText")};d.prototype.CreateTextFont=function(m){var n=this;l.output(n,"CreateTextFont")};d.prototype.ChangeSize=function(m,n){var o=this;o.width=o.originalWidth=m;o.height=o.originalHeight=n;o.changeMode(o.mode,true)};a.UI={ImageUIView:e,ImageUIEditor:d};var h=function(n){var m=true;b.each(f,function(o){if(o instanceof e){if(o.bFocus){m=o.handlerKeyDown(n);if(!m){return false}}}else{if(o instanceof d){if(o.bShow){m=o.handlerKeyDown(n);if(!m){return false}}}}});return m};i.on(j.documentElement,"keydown",h)})(DynamLib,KISSY);function getServerImageBaseUrl(e,d,b){var a=e.httpUrl,c=[a,"img?id=",e.clientId];if(d!==undefined&&d!==null){c.push("&index=");c.push(d)}return c.join("")}function getOffset(b){var c=b.target,a=0,d=0;while(c&&!isNaN(c.offsetLeft)&&!isNaN(c.offsetTop)){a+=c.offsetLeft-c.scrollLeft;d+=c.offsetTop-c.scrollTop;c=c.offsetParent}a=b.clientX-a;d=b.clientY-d;return{x:a,y:d}}CanvasRenderingContext2D.prototype.dashedLineRect=function(m,h,b,n,e){if(typeof e==="undefined"){e=3}var k=[m,m,m+b,m];var j=[h,h,h,h+n];var l=[m+b,m,m+b,m+b];var g=[h,h+n,h+n,h+n];for(var c=0;c<4;c++){var r=(l[c]-k[c]);var p=(g[c]-j[c]);var a=Math.floor(Math.sqrt(r*r+p*p));var f=(e<=0)?a:(a/e);var o=(p/a)*e;var q=(r/a)*e;this.beginPath();for(var d=0;d<f;d++){if(d%2){this.lineTo(k[c]+d*q,j[c]+d*o)}else{this.moveTo(k[c]+d*q,j[c]+d*o)}}this.stroke()}};function Dynamsoft_fetchImageLoop(){var b,a=500;if(DynamLib.images.length>=1){b=DynamLib.images.pop();if(DynamLib.images.length>1){if(b.bNew){a=300}else{a=10}}b.image.src=b.url}setTimeout("Dynamsoft_fetchImageLoop()",a)}Dynamsoft_fetchImageLoop();
(function(a){DynamLib.env.WSVersion="10.0.1";DynamLib.LS=(function(){var b=(window.localStorage)?true:false,c={isSupportLS:function(){return b},item:function(d,e){var f=null;if(this.isSupportLS()){if(e){localStorage.setItem(d,e);f=e}else{f=localStorage.getItem(d)}if(f===null){return false}return f}else{return false}},removeItem:function(d){if(this.isSupportLS()){localStorage.removeItem(d)}else{return false}return true}};return c})();DynamLib.getHttpUrl=function(c){var b=DynamLib.product.ip;if(c.ssl){return["https://",b,":",c.port,"/"].join("")}else{return["http://",b,":",c.port,"/"].join("")}};DynamLib.getWSUrl=function(c){var b=DynamLib.product.ip;if(c.ssl){return["wss://",b,":",c.port].join("")}else{return["ws://",b,":",c.port].join("")}};DynamLib.getWS=function(b){var f=this,d,e=DynamLib.getWSUrl(b),c=DynamLib.product.wsProtocol;if(f.detect.OnCreatWS){f.detect.OnCreatWS(e,c)}if(typeof MozWebSocket!="undefined"){d=new MozWebSocket(e,c)}else{d=new WebSocket(e,c)}return d};DynamLib._init=function(){var h=DynamLib,e=h.LS.item("D_port"),f=h.LS.item("D_ssl"),b=null;h.detect.urls.splice(0);h.detect.cUrlIndex=0;if(e&&f){b={port:e,ssl:(f=="true")}}var d=function(i){if(!b){return true}if(i.port!=b.port||i.ssl!=b.ssl){return true}return false};var g;if(h.detect.detectType===1){if(b!==null&&b.ssl){h.detect.urls.push(b)}for(var c in h.detect.ports){g=h.detect.ports[c];if(g.ssl){if(d(g)){h.detect.urls.push(g)}}}}else{if(h.detect.detectType===0){if(b!==null&&!b.ssl){h.detect.urls.push(b)}for(var c in h.detect.ports){g=h.detect.ports[c];if(g.ssl===false){if(d(g)){h.detect.urls.push(g)}}}}else{if(b!==undefined&&b!==null){h.detect.urls.push(b)}for(var c in h.detect.ports){g=h.detect.ports[c];if(d(g)){h.detect.urls.push(g)}}}}g=null};DynamLib._reconnect=function(){var h=DynamLib,d=h.LS.item("D_port"),f=h.LS.item("D_ssl"),c=null;h.detect.urls.splice(0);h.detect.cUrlIndex=0;if(d&&f){c={port:d,ssl:(f=="true")};h.detect.urls.push(c);var g;if(h.detect.cTwainIndex<h.detect.arySTwains.length){g=h.detect.arySTwains[h.detect.cTwainIndex]}if(!g){return}try{var b=h.getWS(c);g._objWS=b;b.onopen=function(){if(!g.bReady){g.OnReady(true)}DynamLib.detect.hideMask();h.detect.bOK=true};b.onclose=function(){b.onopen=null;if(!g.bReady){setTimeout(DynamLib._reconnect,100)}else{DynamLib.detect.hideMask()}}}catch(e){DynamLib.log(e);if(!g.bReady){setTimeout(DynamLib._reconnect,100)}else{DynamLib.detect.hideMask()}}}};DynamLib.startWS=function(){var f=DynamLib;if(!DynamLib.product.bChromeEdition){DynamLib.appendMessage("This browser is currently not supported. Please try Chrome or Firefox!");return}if(!f.detect.bNoControlEvent){DynamLib.detect.showMask()}if(f.detect.OnDetectNext){f.detect.OnDetectNext()}if(f.detect.tryTimes==0&&f.detect.cUrlIndex>0){if(!f.detect.bNoControlEvent){DynamLib.detect.hideMask();if(KISSY.isFunction(f.detect.onNoControl)){f.detect.onNoControl()}f.detect.bNoControlEvent=true}}if(f.detect.cUrlIndex>=f.detect.urls.length){f.detect.cUrlIndex=0;f.detect.tryTimes++}var d;if(f.detect.cTwainIndex<f.detect.arySTwains.length){d=f.detect.arySTwains[f.detect.cTwainIndex]}else{f.detect.bOK=true;return}try{var e=f.detect.urls[f.detect.cUrlIndex],b=f.getWS(e);DynamLib.log(["connecting ... [port:",e.port,"]"].join(""));d._objWS=b;b.onopen=function(){if(!d.bReady){d.OnReady()}f.detect.cTwainIndex++;if(f.detect.cTwainIndex>=f.detect.arySTwains.length){DynamLib.detect.hideMask();f.detect.bOK=true;if(DynamLib.detect.OnReady){DynamLib.detect.OnReady()}}};b.onclose=function(){b.onopen=null;if(!d.bReady){f.detect.cUrlIndex++;setTimeout(DynamLib.startWS,100)}else{DynamLib.detect.hideMask()}}}catch(c){DynamLib.log(c);if(!d.bReady){f.detect.cUrlIndex++;setTimeout(DynamLib.startWS,100)}else{DynamLib.detect.hideMask()}}};DynamLib.closeAll=function(){var e=this,d,c,b;for(d=0;d<e.detect.arySTwains.length;d++){c=e.detect.arySTwains[d];if(c.bReady){b=c._objWS;if(b){b.close();c._objWS=null;c.bReady=false}}}e.detect.bOK=false;e.detect.arySTwains.splice(0);e.detect.cTwainIndex=0;e.detect.bFirst=true};DynamLib.bio=false;DynamLib.progressMessage="";DynamLib.showDialog=false;DynamLib.dialogShowStatus=false;DynamLib.needShowTwiceShowDialog=false;DynamLib.dlgProgress=false;DynamLib.cancelFrome=0;DynamLib.showProgress=function(e,b,d){var h=e;DynamLib.log("showProgress:"+b+",bCancel:"+d);if(h.__IfShowProgressBar==true){var g=a.one("#btnCancel");if(d==false){g[0].style.display="none"}else{g[0].style.display=""}if(DynamLib.dialogShowStatus==false){DynamLib.dlgProgress.showModal();DynamLib.dialogShowStatus=true;var f=a.one("#progressBar");var c=a.one("#status");c.html("0%");f[0].value=0}DynamLib.showDialog=true}};DynamLib.closeProgress=function(b){DynamLib.log("closeProgress:"+b);var c=a.one("#btnCancel");if(DynamLib.needShowTwiceShowDialog==true&&DynamLib.cancelFrome==1){c.html("Canceling")}else{c.html("Cancel");if(DynamLib.dialogShowStatus==true){DynamLib.dlgProgress.close();DynamLib.dialogShowStatus=false}DynamLib.needShowTwiceShowDialog=false}DynamLib.showDialog=false}})(KISSY);(function(c,a){var e={notSupportProperty:function(f){},notSupportMethod:function(f){},sendData:function(g,q,m,o){var p,l,h,j,f,n,k;if(!o){g.send(q);return}p=q.length;l=m&&m.size?m.size:0;h=p+l;j=new ArrayBuffer(12);f=new DataView(j);for(k=0;k<8;k++){if(h){f.setUint8(k,h%256);h=parseInt(h/256)}else{break}}for(k=0;k<4;k++){if(p){f.setUint8(8+k,p%256);p=parseInt(p/256)}else{break}}n=new Blob([j,q]);g.send(n);if(l>0){g.send(m)}},init:function(i,n){var g,h,l,f,k,m='<dialog id="dialogProgress" style="Top:30%;"><h3 id="finalMessage"></h3><p id="status">0%</p><progress id="progressBar" value="" max="100"></progress><br><button id="btnCancel" value="cancel" autofcus >cancel</button> </dialog>';h=a.one("#"+n);h.attr("class",i.containerClass);h.style("width",i.width);h.style("height",i.height);h.style("overflow","hidden");if(!DynamLib.dlgProgress){h.append(m);k=h.one("#dialogProgress");if(k&&k[0]){DynamLib.dlgProgress=k[0];dialogPolyfill.registerDialog(DynamLib.dlgProgress)}DynamLib.showDialog=false;DynamLib.dialogShowStatus=false;DynamLib.cancelFrome=0;var j=h.one("#btnCancel");j[0].onclick=function(){DynamLib.closeProgress(0);if(DynamLib.bio){DynamLib.bio.abort();DynamLib.bio=false}else{if(DynamLib.cancelFrome==3||DynamLib.cancelFrome==4){i.SetCancel()}}}}e.initImageUI(i,n)},initImageUI:function(i,g){var f={DWObject:i,containerID:g,width:i.width,height:i.height,debug:i.debug},h={DWObject:i,containerID:g,width:i.width,height:i.height,defaultImageUrl:DynamLib.env.resourcesPath+"/reference/imgs/Dynamsoft_bg.png",debug:i.debug};e.bindUIViewEvents(i,f);e.bindUIEditorEvents(i,h);i._UIView=new DynamLib.UI.ImageUIView(f);i._UIEditor=new DynamLib.UI.ImageUIEditor(h);i._UIEditor.hide()},changeImageUISize:function(h,g,i){var f=a.one("#"+h.containerID);h.width=g;h.height=i;f.style("width",h.width);f.style("height",h.height);h._UIView.ChangeSize(g,i);h._UIEditor.ChangeSize(g,i)},bindUIViewEvents:function(g,f){var h=g;f.onSelected=function(i){var k=i.length,j;if(k>0){j=i[k-1];h.__SetSelectedImages(j,i.join(","));h.__cIndex=j;if(e.isFunction(h.__OnRefreshUI)){h.__OnRefreshUI(j)}}};f.onRefreshUI=function(i){e.__innerRefreshFromUIView(h,i)};f.onMouseMove=function(i){if(e.isFunction(h.__OnMouseMove)){h.__OnMouseMove(i)}};f.onMouseClick=function(i){if(e.isFunction(h.__OnMouseClick)){h.__OnMouseClick(i)}};f.onMouseDoubleClick=function(i){if(e.isFunction(h.__OnMouseDoubleClick)){h.__OnMouseDoubleClick(i)}};f.onMouseRightClick=function(i){if(e.isFunction(h.__OnMouseRightClick)){h.__OnMouseRightClick(i)}}},bindUIEditorEvents:function(g,f){var h=g;f.onMouseMove=function(j){var i=j.x,k=j.y;h.__MouseX=i;h.__MouseY=k};f.onRefreshUI=function(i){e.__innerRefreshFromUIEditor(h,i)};f.onImageAreaSelected=function(i){if(e.isFunction(h.__OnImageAreaSelected)){h.__OnImageAreaSelected(i.cIndex,i.left,i.top,i.right,i.bottom)}};f.onImageAreaDeSelected=function(i){if(e.isFunction(h.__OnImageAreaDeSelected)){h.__OnImageAreaDeSelected(i)}}},addImageToUI:function(k,h,g,l,j){var f=e.getServerImageUrl(k,l),i={id:g,src:f,width:0,height:0,bNew:true};if(h==1){k._UIView.add(i,l+1);k._UIEditor.refresh(l,j)}else{if(h==2){k._UIView.add(i,l);k._UIEditor.refresh(l,j)}else{c.log("invalid parameter _op : "+h)}}},isFunction:function(f){return f&&typeof(f)==="function"},__pushElement:function(g,f){if(a.isString(f)){g.push('"');g.push(f);g.push('"')}else{if(a.isArray(f)){var h=true;g.push("[");a.each(f,function(i){if(h){h=false}else{g.push(",")}e.__pushElement(g,i)});g.push("]")}else{g.push(f)}}},makeParams:function(){var g=arguments;if(g===undefined||g.length===0){return undefined}else{var f=[];if(g.length===1){var i=g[0];f.push("[");e.__pushElement(f,i);f.push("]")}else{if(g.length===2){var i=g[0],h=g[1];f.push("[");e.__pushElement(f,i);f.push(",");e.__pushElement(f,h);f.push("]")}else{e.__pushElement(f,Array.prototype.slice.call(g))}}return f.join("")}},getJson:function(h,f,i){var g=[];g.push("{");g.push('"id":"');g.push(h.clientId);g.push('"');g.push(',"method":"');g.push(f);g.push('"');if(i!==undefined&&i!==null){g.push(',"parameter":');g.push(i)}g.push("}");return g.join("")},__adjustImageSize:function(h,l,g){if(l<=h.width||g<=h.height){if(l<=h.width&&g<=h.height){var k=l/h.width,f=g/h.height,i;if(k<f){h.height*=k}else{h.width*=f}}else{if(l<=h.width){h.width=l;h.height=(l/h.width)*h.height}else{if(g<=h.height){h.width=(g/h.height)*h.width;h.height=g}}}}if(h.height<g){var j=((g-h.height)/2)+"px";a.one(h).style("padding-top",j)}else{a.one(h).style("padding-top","0")}},refreshImageAfterInvokeFun:function(f,h,g){return(g==1)},loadHttpBlob:function(k,j,i,h,n,g){var f="loadHttpBlob",l;l=function(p,o,m){if(m.state==2&&m.status==0){k._errorCode=-2304;k._errorString="Http download error, please check the url."}else{k._errorCode=-2305;k._errorString="Http download error."}if(e.isFunction(n)){n()}};DynamLib.bio=new KISSY.IO({type:j,url:i,responseType:"blob",async:true,headers:{"X-Requested-With":false},success:h,error:l,complete:function(){DynamLib.bio=false},beforeSend:function(m){if(e.isFunction(g)){var o=m.getNativeXhr();o.addEventListener("progress",function(p){g(p)},false)}}})},getServerImageUrl:function(j,i,g){var f=j.httpUrl,h=[f,"img?id=",j.clientId];if(i!==undefined&&i!==null){h.push("&index=");h.push(i)}if(g){h.push("&act=");h.push(g)}h.push("&ticks=");h.push(Math.floor(Math.random()*100000+1));return h.join("")},combineUrl:function(i,g,h){var f=[];if(g.indexOf("http://")==0||g.indexOf("https://")==0){}else{if(i.IfSSL){f.push("https://")}else{f.push("http://")}}f.push(g);if(i.HTTPPort&&i.HTTPPort!=80&&g.indexOf(":")<0){f.push(":");f.push(i.HTTPPort)}if(h.indexOf("/")!==0){f.push("/")}f.push(h);return f.join("")},httpPostUpload:function(i,h,g,f,j){if(!g){i._errorCode=-2306;i._errorString="Upload Error: the upload file cannot be empty.";if(e.isFunction(j)){j()}return}g.remoteFilename=i.__remoteFilename;DynamLib.bio=new KISSY.BIO({action:h,data:i.httpFormFields});i.__HTTPPostResponseString=false;DynamLib.bio.on(a.BIO.event.SUCCESS,function(k){DynamLib.bio=false;i._errorCode=0;i.__HTTPPostResponseString="";if(e.isFunction(f)){f()}});DynamLib.bio.on(a.BIO.event.ERROR,function(k){var l;DynamLib.bio=false;i._errorCode=-2003;if(k&&k.result&&k.result.msg){i.__HTTPPostResponseString=k.result.msg;if(k.result.msg.toLowerCase()==="canceled"){i._errorCode=-2303;l="Http upload canceled"}else{l="Http upload error: "+k.result.msg}}else{if(k&&k.result){i.__HTTPPostResponseString=k.result}else{i.__HTTPPostResponseString=""}l="Http upload error."}i._errorString=l;if(e.isFunction(j)){j()}});DynamLib.bio.on(a.BIO.event.PROGRESS,function(k){var l=(k.total===0)?100:Math.round(k.loaded*100/k.total),m=[k.loaded," / ",k.total].join("");i._OnPercentDone([0,l,""])});i._OnPercentDone([0,-1,"uploading..."]);DynamLib.bio.addBlob(g);DynamLib.bio.uploadFiles(a.BIO.status.WAITING);return true},httpPutImage:function(j,h,g,i,k,f){DynamLib.bio=new KISSY.IO({type:"PUT",url:h,hasContent:true,processData:false,data:g,headers:{"X-Requested-With":false},success:i,error:k,complete:function(){DynamLib.bio=false},beforeSend:function(l){if(e.isFunction(f)){var m=l.getNativeXhr();m.upload.addEventListener("progress",function(n){f(n)},false)}}});return true},dialog:false,dialogRef:0,showMask:function(g){var f=this;c.log("showMask:"+g+"--"+f.dialogRef);if(f.dialogRef==0){var i=[DynamLib.env.resourcesPath,"/reference/loading.gif"].join(""),h=['<img src="',i,'" />'].join("");f.dialog=new KISSY.Overlay({width:400,content:h,mask:true,align:{points:["cc","cc"]}});f.dialog.show()}f.dialogRef++},hideMask:function(g){var f=this;c.log("hideMask:"+g+"--"+f.dialogRef);if(f.dialogRef>1){f.dialogRef--}else{if(f.dialogRef<=1){if(f.dialog){f.dialog.destroy()}f.dialog=false;f.dialogRef=0}}},setBtnCancelVisibleForProgress:function(h,g){var f=this;if(h.__IfShowProgressBar==true){var i=a.one("#btnCancel");if(g==false){i[0].style.display="none"}else{i[0].style.display=""}}},EVENTS:["OnPostAllTransfers","OnPostTransfer","OnPostLoad","OnPreTransfer","OnPreAllTransfers","OnResult","OnTransferCancelled","OnTransferError","OnSourceUIClose","OnBitmapChanged","OnGetFilePath","OnPercentDone"],SEND_BACK_EVENTS:["OnPreAllTransfers","OnPreTransfer","OnPostTransfer","OnPostLoad","OnGetFilePath"],handleEvent:function(i,g){var k=this,h=g.result[0],f=i._objWS,j=false;a.each(e.EVENTS,function(n,m){if(g.event===n){var l=["_",n].join("");j=true;if(e.isFunction(i[l])){i[l](g.result)}return false}});if(j){c.log("handled event:"+g.event);a.each(e.SEND_BACK_EVENTS,function(m,l){if(g.event===m){c.log("sendback event:"+g.event);e.sendData(f,e.getJson(i,g.event,e.makeParams(h)),false,true);return false}})}return j},getImageType:function(g){var f=g.length;if(f<4){return -1}var h=g.lastIndexOf(".");if(h===-1){return -1}var i=g.slice(h).toLowerCase();if(i===".bmp"||i===".dib"){return 0}if(i===".jpg"||i===".jpe"||i===".jpeg"||i===".jfif"){return 1}if(i===".tif"||i===".tiff"){return 2}if(i===".png"){return 3}if(i===".pdf"){return 4}if(i===".gif"){return 5}return -1},autoDiscardBlankImage:function(i,f){if(c.config.bDiscardBlankImage){var g=i.CurrentImageIndexInBuffer;if(i.IsBlankImage(g)){i.RemoveImage(g)}var h=["Blank Discard (",f,"): ",i.ErrorString].join("");if(e.isFunction(i.__OnPrintMsg)){i.__OnPrintMsg(h)}}},replaceLocalFilename:function(g){var h;if(DynamLib.env.bWin){h=g.replace(/\\/g,"\\\\")}else{h=g}if(DynamLib.env.bFileSystem){h=decodeURI(h)}return h},__innerRefreshFromUIView:function(f,g){var h=f;if(g>=0){h.CurrentImageIndexInBuffer=g;h._UIEditor.refresh(h.__cIndex,h._HowManyImagesInBuffer)}if(e.isFunction(h.__OnRefreshUI)){h.__OnRefreshUI(g)}},__innerRefreshFromUIEditor:function(g,i){var j=g;j.CurrentImageIndexInBuffer=i;if(i>=0&&i<j._UIView.count()){var f=j._UIView.aryImages[i],h;f.src=e.getServerImageUrl(j,i);j._UIView.set(f,i);j._UIView.go(i)}if(e.isFunction(j.__OnRefreshUI)){j.__OnRefreshUI(i)}},callbacks:[],pushCallback:function(f,i,g){var h={method:f,callback:i,ticks:g};e.callbacks(h)},refreshUIRef:0};function d(g){var f=this;f._parent=g;f._w=g.width;f._h=g.height}d.prototype={get width(){return this._w},get height(){return this._h},set width(f){var g=this;g._w=f;e.changeImageUISize(g._parent,g._w,g._h)},set height(f){var g=this;g._h=f;e.changeImageUISize(g._parent,g._w,g._h)}};d.prototype.SetSize=function(f,g){var i=this;i._w=f;i._h=g;e.changeImageUISize(i._parent,i._w,i._h);return i};function b(f){var g=this,h=f||{};g.clientId=Math.floor(Math.random()*1000000000+1);g.containerID=h.containerID||("dwt-container-"+g.clientId);if(DynamLib.env.bFirefox){g.containerClass="ds-dwt-container relativePositioning noPadding"}else{g.containerClass="ds-dwt-container noPadding"}g.width=h.width||580;g.height=h.height||600;e.init(g,g.containerID);g.objectName=g.containerID+"_obj";g.bReady=false;g.httpFormFields={};g._objWS=null;g.curCommand=[];DynamLib.__innerInitEvents(g,h);g.__OnMouseClick=h.onMouseClick||"";g.__OnMouseDoubleClick=h.onMouseDoubleClick||"";g.__OnMouseRightClick=h.onMouseRightClick||"";g.__OnMouseMove=h.onMouseMove||"";g.__OnImageAreaSelected=h.onImageAreaSelected||"";g.__OnImageAreaDeSelected=h.onImageAreaDeSelected||"";g.__OnWSReady=h.onWSReady||null;g.__OnWSClose=h.onWSClose||null;g.__OnWSMessage=h.onWSMessage||null;g.__OnPercentDone=h.onPercentDone||"";g.__OnRefreshUI=h.onRefreshUI||"";g.__OnPrintMsg=h.onPrintMsg||"";g.__OnResult=h.onResult||"";g.HTTPPassword=h.HTTPPassword||"";g.HTTPPort=h.HTTPPort||80;g.HTTPUserName=h.HTTPUserName||"";g.__HTTPPostResponseString="";g.strHttpContentTypeFieldValue="octstream";g.__IfShowProgressBar=true;g.__cIndex=-1;g._HowManyImagesInBuffer=0;g._errorCode=0;g._errorString="";g.__bLoadingImage=false;g.__backgroundColor=false;g.__MouseX=0;g.__MouseY=0;g.__style=new d(g);g.__remoteFilename="RemoteFile";g.__versionInfo=""}b.prototype={get ErrorCode(){return this._errorCode},get ErrorString(){if(this._errorCode!=0){return this._errorString}return"Successful."},get LogLevel(){return this._innerFun("LogLevel")},set LogLevel(g){var h=this,f=g*1;return h._innerFun("LogLevel",e.makeParams(f))},get Manufacturer(){return this._innerFun("Manufacturer")},set Manufacturer(f){return this._innerFun("Manufacturer",e.makeParams(f))},get ProductFamily(){return this._innerFun("ProductFamily")},set ProductFamily(f){return this._innerFun("ProductFamily",e.makeParams(f))},get ProductKey(){return c.product.ProductKey},set ProductKey(f){c.product.ProductKey=f;return this._innerFun("ProductKey",e.makeParams(f))},get ProductName(){return this._innerFun("ProductName")},set ProductName(f){return this._innerFun("ProductName",e.makeParams(f))},get VersionInfo(){return this.__versionInfo},get BitDepth(){return this._innerFun("BitDepth")},set BitDepth(f){return this._innerFun("BitDepth",e.makeParams(f))},get Brightness(){return this._innerFun("Brightness")},set Brightness(f){return this._innerFun("Brightness",e.makeParams(f))},get Contrast(){return this._innerFun("Contrast")},set Contrast(f){return this._innerFun("Contrast",e.makeParams(f))},get CurrentSourceName(){return this._innerFun("CurrentSourceName")},get DataSourceStatus(){return this._innerFun("DataSourceStatus")},get DefaultSourceName(){return this._innerFun("DefaultSourceName")},get Duplex(){return this._innerFun("Duplex")},get IfAppendImage(){return this._innerFun("IfAppendImage")},set IfAppendImage(f){return this._innerFun("IfAppendImage",e.makeParams(f))},get IfAutoBright(){return this._innerFun("IfAutoBright")},set IfAutoBright(f){return this._innerFun("IfAutoBright",e.makeParams(f))},get IfAutoDiscardBlankpages(){return this._innerFun("IfAutoDiscardBlankpages")},set IfAutoDiscardBlankpages(f){return this._innerFun("IfAutoDiscardBlankpages",e.makeParams(f))},get IfAutoFeed(){return this._innerFun("IfAutoFeed")},set IfAutoFeed(f){return this._innerFun("IfAutoFeed",e.makeParams(f))},get IfAutomaticBorderDetection(){return this._innerFun("IfAutomaticBorderDetection")},set IfAutomaticBorderDetection(f){return this._innerFun("IfAutomaticBorderDetection",e.makeParams(f))},get IfAutomaticDeskew(){return this._innerFun("IfAutomaticDeskew")},set IfAutomaticDeskew(f){return this._innerFun("IfAutomaticDeskew",e.makeParams(f))},get IfAutoScan(){return this._innerFun("IfAutoScan")},set IfAutoScan(f){return this._innerFun("IfAutoScan",e.makeParams(f))},get IfDeviceOnline(){return this._innerFun("IfDeviceOnline")},get IfDisableSourceAfterAcquire(){return this._innerFun("IfDisableSourceAfterAcquire")},set IfDisableSourceAfterAcquire(f){return this._innerFun("IfDisableSourceAfterAcquire",e.makeParams(f))},get IfDuplexEnabled(){return this._innerFun("IfDuplexEnabled")},set IfDuplexEnabled(f){return this._innerFun("IfDuplexEnabled",e.makeParams(f))},get IfFeederEnabled(){return this._innerFun("IfFeederEnabled")},set IfFeederEnabled(f){return this._innerFun("IfFeederEnabled",e.makeParams(f))},get IfFeederLoaded(){return this._innerFun("IfFeederLoaded")},get IfModalUI(){return this._innerFun("IfModalUI")},set IfModalUI(f){return this._innerFun("IfModalUI",e.makeParams(f))},get IfPaperDetectable(){return this._innerFun("IfPaperDetectable")},get IfScanInNewThread(){return this._innerFun("IfScanInNewThread")},set IfScanInNewThread(f){return this._innerFun("IfScanInNewThread",e.makeParams(f))},get IfShowCancelDialogWhenImageTransfer(){return this._innerFun("IfShowCancelDialogWhenImageTransfer")},set IfShowCancelDialogWhenImageTransfer(f){return this._innerFun("IfShowCancelDialogWhenImageTransfer",e.makeParams(f))},get IfShowUI(){return this._innerFun("IfShowUI")},set IfShowUI(f){return this._innerFun("IfShowUI",e.makeParams(f))},get IfShowIndicator(){return this._innerFun("IfShowIndicator")},set IfShowIndicator(f){return this._innerFun("IfShowIndicator",e.makeParams(f))},get IfUseTwainDSM(){return this._innerFun("IfUseTwainDSM")},set IfUseTwainDSM(f){return this._innerFun("IfUseTwainDSM",e.makeParams(f))},get IfUIControllable(){return this._innerFun("IfUIControllable")},get ImageBitsPerPixel(){return this._innerFun("ImageBitsPerPixel")},get ImageCaptureDriverType(){return this._innerFun(ImageCaptureDriverType)},set ImageCaptureDriverType(f){return this._innerFun("ImageCaptureDriverType",e.makeParams(f))},get ImageLayoutDocumentNumber(){return this._innerFun("ImageLayoutDocumentNumber")},get ImageLayoutFrameBottom(){return this._innerFun("ImageLayoutFrameBottom")},get ImageLayoutFrameLeft(){return this._innerFun("ImageLayoutFrameLeft")},get ImageLayoutFrameNumber(){return this._innerFun("ImageLayoutFrameNumber")},get ImageLayoutFrameRight(){return this._innerFun("ImageLayoutFrameRight")},get ImageLayoutFrameTop(){return this._innerFun("ImageLayoutFrameTop")},get ImageLayoutPageNumber(){return this._innerFun("ImageLayoutPageNumber")},get ImageLength(){return this._innerFun("ImageLength")},get ImagePixelType(){return this._innerFun("ImagePixelType")},get ImageWidth(){return this._innerFun("ImageWidth")},get ImageXResolution(){return this._innerFun("ImageXResolution")},get ImageYResolution(){return this._innerFun("ImageYResolution")},get MagData(){return this._innerFun("MagData")},get MagType(){return this._innerFun("MagType")},get PageSize(){return this._innerFun("PageSize")},set PageSize(g){var h=this,f=g*1;return h._innerFun("PageSize",e.makeParams(f))},get PendingXfers(){return this._innerFun("PendingXfers")},get PixelFlavor(){return this._innerFun("PixelFlavor")},set PixelFlavor(f){return this._innerFun("PixelFlavor",e.makeParams(f))},get PixelType(){return this._innerFun("PixelType")},set PixelType(f){return this._innerFun("PixelType",e.makeParams(f))},get Resolution(){return this._innerFun("Resolution")},set Resolution(g){var h=this,f=g*1;return h._innerFun("Resolution",e.makeParams(f))},get SourceCount(){return this._innerFun("SourceCount")},get TransferMode(){return this._innerFun("TransferMode")},set TransferMode(f){return this._innerFun("TransferMode",e.makeParams(f))},get Unit(){return this._innerFun("Unit")},set Unit(f){return this._innerFun("Unit",e.makeParams(f))},get XferCount(){return this._innerFun("XferCount")},set XferCount(g){var h=this,f=g*1;return h._innerFun("XferCount",e.makeParams(f))},get CapCurrentIndex(){return this._innerFun("CapCurrentIndex")},set CapCurrentIndex(f){return this._innerFun("CapCurrentIndex",e.makeParams(f))},get CapCurrentValue(){return this._innerFun("CapCurrentValue")},set CapCurrentValue(f){return this._innerFun("CapCurrentValue",e.makeParams(f))},get CapDefaultIndex(){return this._innerFun("CapDefaultIndex")},get CapDefaultValue(){return this._innerFun("CapDefaultValue")},get CapDescription(){return this._innerFun("CapDescription")},set CapDescription(f){return this._innerFun("CapDescription",e.makeParams(f))},get CapMaxValue(){return this._innerFun("CapMaxValue")},set CapMaxValue(f){return this._innerFun("CapMaxValue",e.makeParams(f))},get CapMinValue(){return this._innerFun("CapMinValue")},set CapMinValue(f){return this._innerFun("CapMinValue",e.makeParams(f))},get CapNumItems(){return this._innerFun("CapNumItems")},set CapNumItems(f){return this._innerFun("CapNumItems",e.makeParams(f))},get CapStepSize(){return this._innerFun("CapStepSize")},set CapStepSize(f){return this._innerFun("CapStepSize",e.makeParams(f))},get CapType(){return this._innerFun("CapType")},set CapType(f){return this._innerFun("CapType",e.makeParams(f))},get CapValue(){return this._innerFun("CapValue")},set CapValue(f){return this._innerFun("CapValue",e.makeParams(f))},get CapValueString(){return this._innerFun("CapValueString")},set CapValueString(f){return this._innerFun("CapValueString",e.makeParams(f))},get CapValueType(){return this._innerFun("CapValueType")},set CapValueType(f){return this._innerFun("CapValueType",e.makeParams(f))},get AllowMultiSelect(){var f=this;return f._UIView.getAllowMultiSelect()},set AllowMultiSelect(f){var g=this;g._UIView.setAllowMultiSelect(f)},get BackgroundColor(){var f=this;return f.__backgroundColor},set BackgroundColor(f){var g=this;g.__backgroundColor=f;g._UIView.setBackgroundColor(f);g._UIEditor.setBackgroundColor(f)},get BackgroundFillColor(){return this._innerFun("BackgroundFillColor")},set BackgroundFillColor(f){return this._innerFun("BackgroundFillColor",e.makeParams(f))},get BlankImageCurrentStdDev(){return this._innerFun("BlankImageCurrentStdDev")},set BlankImageCurrentStdDev(f){return this._innerFun("BlankImageCurrentStdDev",e.makeParams(f))},get BlankImageMaxStdDev(){return this._innerFun("BlankImageMaxStdDev")},set BlankImageMaxStdDev(f){return this._innerFun("BlankImageMaxStdDev",e.makeParams(f))},get BlankImageThreshold(){return this._innerFun("BlankImageThreshold")},set BlankImageThreshold(f){return this._innerFun("BlankImageThreshold",e.makeParams(f))},get CurrentImageIndexInBuffer(){return this.__cIndex},set CurrentImageIndexInBuffer(f){this._innerFun("CurrentImageIndexInBuffer",e.makeParams(f),true);this.__cIndex=f;return true},get FitWindowType(){var f=this;return f._UIEditor.getFitWindowType()},set FitWindowType(g){var h=this,f=g*1;return h._UIEditor.setFitWindowType(f)},get HowManyImagesInBuffer(){var f=this;return f._HowManyImagesInBuffer},set HowManyImagesInBuffer(g){var h=this,f=g*1;h._HowManyImagesInBuffer=f;return true},get IfFitWindow(){var f=this;return f._UIEditor.getFitWindowType()==0},set IfFitWindow(f){var g=this;if(f){return g._UIEditor.setFitWindowType(0)}else{return g._UIEditor.setFitWindowType(3)}},get ImageMargin(){var f=this;return f._UIView.getImageMargin()},set ImageMargin(f){var g=this;return g._UIView.setImageMargin(f)},get MaxImagesInBuffer(){return this._innerFun("MaxImagesInBuffer")},set MaxImagesInBuffer(f){return this._innerFun("MaxImagesInBuffer",e.makeParams(f))},get MouseX(){var f=this;return f.__MouseX},get MouseY(){var f=this;return f.__MouseY},get SelectedImagesCount(){return this._innerFun("SelectedImagesCount")},set SelectedImagesCount(f){return this._innerFun("SelectedImagesCount",e.makeParams(f))},get SelectionImageBorderColor(){var f=this;return f._UIView.getSelectionImageBorderColor()},set SelectionImageBorderColor(f){var g=this;return g._UIView.setSelectionImageBorderColor(f)},get Zoom(){var f=this;return f._UIEditor.getZoom()},set Zoom(f){var g=this;return g._UIEditor.setZoom(f)},get MouseShape(){var f=this;return f._UIEditor.getMouseShape()},set MouseShape(f){var g=this;return g._UIEditor.setMouseShape(f)},get HTTPPostResponseString(){if(this.__HTTPPostResponseString){return this.__HTTPPostResponseString}else{return""}},get AsyncMode(){return this._innerFun("AsyncMode")},set AsyncMode(f){return this._innerFun("AsyncMode",e.makeParams(f))},get FTPPassword(){return this._innerFun("FTPPassword")},set FTPPassword(f){return this._innerFun("FTPPassword",e.makeParams(f))},get FTPPort(){return this._innerFun("FTPPort")},set FTPPort(g){if(g!==""){var h=this,f=g*1;return h._innerFun("FTPPort",e.makeParams(f))}},get FTPUserName(){return this._innerFun("FTPUserName")},set FTPUserName(f){return this._innerFun("FTPUserName",e.makeParams(f))},get IfPASVMode(){return this._innerFun("IfPASVMode")},set IfPASVMode(f){return this._innerFun("IfPASVMode",e.makeParams(f))},get IfShowProgressBar(){return this.__IfShowProgressBar},set IfShowProgressBar(f){return this.__IfShowProgressBar=f},get ProxyServer(){return this._innerFun("ProxyServer")},set ProxyServer(f){return this._innerFun("ProxyServer",e.makeParams(f))},get IfShowFileDialog(){return this._innerFun("IfShowFileDialog")},set IfShowFileDialog(f){return this._innerFun("IfShowFileDialog",e.makeParams(f))},get IfTiffMultiPage(){return this._innerFun("IfTiffMultiPage")},set IfTiffMultiPage(f){return this._innerFun("IfTiffMultiPage",e.makeParams(f))},get PDFAuthor(){return this._innerFun("PDFAuthor")},set PDFAuthor(f){return this._innerFun("PDFAuthor",e.makeParams(f))},get PDFCompressionType(){return this._innerFun("PDFCompressionType")},set PDFCompressionType(f){return this._innerFun("PDFCompressionType",e.makeParams(f))},get PDFCreationDate(){return this._innerFun("PDFCreationDate")},set PDFCreationDate(f){return this._innerFun("PDFCreationDate",e.makeParams(f))},get PDFCreator(){return this._innerFun("PDFCreator")},set PDFCreator(f){return this._innerFun("PDFCreator",e.makeParams(f))},get PDFKeywords(){return this._innerFun("PDFKeywords")},set PDFKeywords(f){return this._innerFun("PDFKeywords",e.makeParams(f))},get PDFModifiedDate(){return this._innerFun("PDFModifiedDate")},set PDFModifiedDate(f){return this._innerFun("PDFModifiedDate",e.makeParams(f))},get PDFProducer(){return this._innerFun("PDFProducer")},set PDFProducer(f){return this._innerFun("PDFProducer",e.makeParams(f))},get PDFSubject(){return this._innerFun("PDFSubject")},set PDFSubject(f){return this._innerFun("PDFSubject",e.makeParams(f))},get PDFTitle(){return this._innerFun("PDFTitle")},set PDFTitle(f){return this._innerFun("PDFTitle",e.makeParams(f))},get PDFVersion(){return this._innerFun("PDFVersion")},set PDFVersion(f){return this._innerFun("PDFVersion",e.makeParams(f))},get TIFFCompressionType(){return this._innerFun("TIFFCompressionType")},set TIFFCompressionType(f){return this._innerFun("TIFFCompressionType",e.makeParams(f))},get JPEGQuality(){return this._innerFun("JPEGQuality")},set JPEGQuality(g){var h=this,f=g*1;if(f>=100){f=100}return h._innerFun("JPEGQuality",e.makeParams(f))},get HttpContentTypeFieldValue(){return this.strHttpContentTypeFieldValue},set HttpContentTypeFieldValue(f){this.strHttpContentTypeFieldValue=f},get SelectionRectAspectRatio(){return this._innerFun("SelectionRectAspectRatio")},set SelectionRectAspectRatio(f){return this._innerFun("SelectionRectAspectRatio",e.makeParams(f))},get IfAllowLocalCache(){return this._innerFun("IfAllowLocalCache")},set IfAllowLocalCache(f){return this._innerFun("IfAllowLocalCache",e.makeParams(f))},get AutoCropMethod(){return this._innerFun("AutoCropMethod")},set AutoCropMethod(f){return this._innerFun("AutoCropMethod",e.makeParams(f))},get BrokerProcessType(){return""},set BrokerProcessType(f){return true},get BorderStyle(){return this._innerFun("BorderStyle")},set BorderStyle(f){return this._innerFun("BorderStyle",e.makeParams(f))},get IfShowPrintUI(){return this._innerFun("IfShowPrintUI")},set IfShowPrintUI(f){return this._innerFun("IfShowPrintUI",e.makeParams(f))},get VScrollBar(){return this._innerFun("VScrollBar")},set VScrollBar(f){return this._innerFun("VScrollBar",e.makeParams(f))},get EnableInteractiveZoom(){return this._innerFun("EnableInteractiveZoom")},set EnableInteractiveZoom(f){return this._innerFun("EnableInteractiveZoom",e.makeParams(f))},get ImageEditorIfEnableEnumerator(){return this._innerFun("ImageEditorIfEnableEnumerator")},set ImageEditorIfEnableEnumerator(f){return this._innerFun("ImageEditorIfEnableEnumerator",e.makeParams(f))},get ImageEditorIfReadonly(){return this._innerFun("ImageEditorIfReadonly")},set ImageEditorIfReadonly(f){return this._innerFun("ImageEditorIfReadonly",e.makeParams(f))},get ImageEditorIfModal(){return this._innerFun("ImageEditorIfModal")},set ImageEditorIfModal(f){return this._innerFun("ImageEditorIfModal",e.makeParams(f))},get ImageEditorWindowTitle(){return this._innerFun("ImageEditorWindowTitle")},set ImageEditorWindowTitle(f){return this._innerFun("ImageEditorWindowTitle",e.makeParams(f))},get IfSSL(){return this._innerFun("IfSSL")},set IfSSL(f){return this._innerFun("IfSSL",e.makeParams(f))},get AllowPluginAuthentication(){return this._innerFun("AllowPluginAuthentication")},set AllowPluginAuthentication(f){return this._innerFun("AllowPluginAuthentication",e.makeParams(f))},get HttpFieldNameOfUploadedImage(){return this.__remoteFilename},set HttpFieldNameOfUploadedImage(f){return this.__remoteFilename=f},get MaxInternetTransferThreads(){return this._innerFun("MaxInternetTransferThreads")},set MaxInternetTransferThreads(f){return this._innerFun("MaxInternetTransferThreads",e.makeParams(f))},get IfOpenImageWithGDIPlus(){return this._innerFun("IfOpenImageWithGDIPlus")},set IfOpenImageWithGDIPlus(f){return this._innerFun("IfOpenImageWithGDIPlus",e.makeParams(f))},get style(){return this.__style}};b.prototype.getInstance=function(){return this};b.prototype.RegisterEvent=function(f,h){var g=["__",f].join("");this[g]=h};b.prototype.onEvent=function(f,g){this.RegisterEvent(f,g)};b.prototype.on=function(f,g){this.RegisterEvent(f,g)};b.prototype.first=function(){var g=this,f=g._UIView.count();if(f>0){g._UIView.go(0,function(){e.__innerRefreshFromUIView(g,g._UIView.cIndex)})}};b.prototype.previous=function(){var g=this,f=g._UIView.count();if(f>0){g._UIView.previous(function(){e.__innerRefreshFromUIView(g,g._UIView.cIndex)})}};b.prototype.next=function(){var g=this,f=g._UIView.count();if(f>0){g._UIView.next(function(){e.__innerRefreshFromUIView(g,g._UIView.cIndex)})}};b.prototype.last=function(){var g=this,f=g._UIView.count();if(f>0){g._UIView.go(f-1,function(){e.__innerRefreshFromUIView(g,g._UIView.cIndex)})}};b.prototype.CancelAllPendingTransfers=function(){return this._innerFun("CancelAllPendingTransfers")};b.prototype.CloseSource=function(){return this._innerFun("CloseSource")};b.prototype.CloseSourceManager=function(){return this._innerFun("CloseSourceManager")};b.prototype.DisableSource=function(){return this._innerFun("DisableSource")};b.prototype.FeedPage=function(){return this._innerFun("FeedPage")};b.prototype.GetDeviceType=function(){return this._innerFun("GetDeviceType")};b.prototype.GetSourceNameItems=function(f){return this._innerFun("GetSourceNameItems",e.makeParams(f))};b.prototype.GetSourceNames=function(){var g=this,f=g._innerFunRaw("GetSourceNames");if(g._errorCode!=0){return[]}return f};b.prototype.GetSourceType=function(f){return this._innerFun("GetSourceType",e.makeParams(f))};b.prototype.OpenSource=function(){return this._innerFun("OpenSource")};b.prototype.OpenSourceManager=function(){return this._innerFun("OpenSourceManager")};b.prototype.ResetImageLayout=function(){return this._innerFun("ResetImageLayout")};b.prototype.RewindPage=function(){return this._innerFun("RewindPage")};b.prototype.SelectSource=function(){return this._innerFun("SelectSource")};b.prototype.SelectSourceByIndex=function(f){return this._innerFun("SelectSourceByIndex",e.makeParams(f))};b.prototype.SetFileXferInfo=function(g,i){var h=e.replaceLocalFilename(g);return this._innerFun("SetFileXferInfo",e.makeParams(h,i))};b.prototype.SetImageLayout=function(i,h,g,f){return this._innerFun("SetImageLayout",e.makeParams(i,h,g,f))};b.prototype.CapGet=function(){return this._innerFun("CapGet")};b.prototype.CapGetCurrent=function(){return this._innerFun("CapGetCurrent")};b.prototype.CapGetDefault=function(){return this._innerFun("CapGetDefault")};b.prototype.CapGetFrameBottom=function(f){return this._innerFun("CapGetFrameBottom",e.makeParams(f))};b.prototype.CapGetFrameLeft=function(f){return this._innerFun("CapGetFrameLeft",e.makeParams(f))};b.prototype.CapGetFrameRight=function(f){return this._innerFun("CapGetFrameRight",e.makeParams(f))};b.prototype.CapGetFrameTop=function(f){return this._innerFun("CapGetFrameTop",e.makeParams(f))};b.prototype.CapIfSupported=function(f){return this._innerFun("CapIfSupported",e.makeParams(f))};b.prototype.CapReset=function(){return this._innerFun("CapReset")};b.prototype.CapSet=function(){return this._innerFun("CapSet")};b.prototype.CapSetFrame=function(g,j,i,h,f){return this._innerFun("CapSetFrame",e.makeParams(g,j,i,h,f))};b.prototype.GetCapItems=function(f){return this._innerFun("GetCapItems",e.makeParams(f))};b.prototype.GetCapItemsString=function(f){return this._innerFun("GetCapItemsString",e.makeParams(f))};b.prototype.SetCapItems=function(g,f){return this._innerFun("SetCapItems",e.makeParams(g,f))};b.prototype.SetCapItemsString=function(g,f){return this._innerFun("SetCapItemsString",e.makeParams(g,f))};b.prototype.AddText=function(k,f,m,l,j,h,i,g){return this._innerFun("AddText",e.makeParams(k,f,m,l,j,h,i,g))};b.prototype.CreateTextFont=function(h,s,m,l,o,p,i,q,f,n,j,k,r,g){return this._innerFun("CreateTextFont",e.makeParams(h,s,m,l,o,p,i,q,f,n,j,k,r,g))};b.prototype.CopyToClipboard=function(f){return this._innerFun("CopyToClipboard",e.makeParams(f))};b.prototype.Erase=function(h,j,i,g,f){return this._innerFun("Erase",e.makeParams(h,j,i,g,f))};b.prototype.GetImageBitDepth=function(f){return this._innerFun("GetImageBitDepth",e.makeParams(f))};b.prototype.GetImageWidth=function(f){return this._innerFun("GetImageWidth",e.makeParams(f))};b.prototype.GetImageHeight=function(f){return this._innerFun("GetImageHeight",e.makeParams(f))};b.prototype.GetImageSize=function(g,f,h){return this._innerFun("GetImageSize",e.makeParams(g,f,h))};b.prototype.GetImageSizeWithSpecifiedType=function(f,g){return this._innerFun("GetImageSizeWithSpecifiedType",e.makeParams(f,g))};b.prototype.GetImageXResolution=function(f){return this._innerFun("GetImageXResolution",e.makeParams(f))};b.prototype.GetImageYResolution=function(f){return this._innerFun("GetImageYResolution",e.makeParams(f))};b.prototype.GetSelectedImageIndex=function(f){return this._innerFun("GetSelectedImageIndex",e.makeParams(f))};b.prototype.SetSelectedImageIndex=function(g,f){return this._innerFun("SetSelectedImageIndex",e.makeParams(g,f))};b.prototype.GetSelectedImagesSize=function(f){return this._innerFun("GetSelectedImagesSize",e.makeParams(f))};b.prototype.GetSkewAngle=function(f){return this._innerFun("GetSkewAngle",e.makeParams(f))};b.prototype.GetSkewAngleEx=function(h,j,i,g,f){return this._innerFun("GetSkewAngleEx",e.makeParams(h,j,i,g,f))};b.prototype.IsBlankImageEx=function(h,j,i,g,f,k){return this._innerFun("IsBlankImageEx",e.makeParams(h,j,i,g,f,k))};b.prototype.Mirror=function(f){return this._innerFun("Mirror",e.makeParams(f))};b.prototype.OverlayRectangle=function(j,l,k,h,g,f,i){return this._innerFun("OverlayRectangle",e.makeParams(j,l,k,h,g,f,i))};b.prototype.RemoveAllImages=function(){return this._innerFun("RemoveAllImages",e.makeParams())};b.prototype.RemoveAllSelectedImages=function(){var g=this,f;f=g._innerFun("RemoveAllSelectedImages");g._UIView.RemoveAllSelectedImages();return f};b.prototype.RemoveImage=function(f){return this._innerFun("RemoveImage",e.makeParams(f))};b.prototype.Rotate=function(i,g,h){var l=this,f=parseInt(i),j=l._innerFun("Rotate",e.makeParams(f,g,h)),k=(j==1);if(k){e.refreshImageAfterInvokeFun(l,f)}return k};b.prototype.RotateEx=function(j,h,i,f){var m=this,g=parseInt(j),k=m._innerFun("RotateEx",e.makeParams(g,h,i,f)),l=(k==1);if(l){e.refreshImageAfterInvokeFun(m,g)}return l};b.prototype.RotateLeft=function(g){var j=this,f=parseInt(g),h=j._innerFun("RotateLeft",e.makeParams(f)),i=(h==1);if(i){e.refreshImageAfterInvokeFun(j,f)}return i};b.prototype.RotateRight=function(g){var j=this,f=parseInt(g),h=j._innerFun("RotateRight",e.makeParams(f)),i=(h==1);if(i){e.refreshImageAfterInvokeFun(j,f)}return i};b.prototype.ChangeImageSize=function(o,g,l,n){var i=this,j=parseInt(o),m=1*g,k=1*l,f,h;if(m<=0||k<=0){i._errorCode=-2307;i._errorString="The width or height you entered is invalid.";return false}f=i._innerFun("ChangeImageSize",e.makeParams(j,m,k,n));h=(f==1);if(h){e.refreshImageAfterInvokeFun(i,j)}return h};b.prototype.Flip=function(g){var j=this,f=parseInt(g),h=j._innerFun("Flip",e.makeParams(f)),i=(h==1);if(i){e.refreshImageAfterInvokeFun(j,f)}return i};b.prototype.Crop=function(n,h,l,m,g){var j=this,k=parseInt(n),f=j._innerFun("Crop",e.makeParams(k,h,l,m,g)),i=(f==1);if(i){e.refreshImageAfterInvokeFun(j,k)}return i};b.prototype.CropToClipboard=function(n,h,l,m,g){var j=this,k=parseInt(n),f=j._innerFun("CropToClipboard",e.makeParams(k,h,l,m,g)),i=(f==1);if(i){e.refreshImageAfterInvokeFun(j,k)}return i};b.prototype.CutFrameToClipboard=function(n,h,l,m,g){var j=this,k=parseInt(n),f=j._innerFun("CutFrameToClipboard",e.makeParams(k,h,l,m,g)),i=(f==1);if(i){e.refreshImageAfterInvokeFun(j,k)}return i};b.prototype.CutToClipboard=function(g){var j=this,f=parseInt(g),h=j._innerFun("CutToClipboard",e.makeParams(f)),i=(h==1);if(i){e.refreshImageAfterInvokeFun(j,f)}return i};b.prototype.SetDPI=function(j,g,i,f,h){return this._innerFun("SetDPI",e.makeParams(j,g,i,f,h))};b.prototype.SetViewMode=function(g,f){if(g==-1&&f==-1){this._UIEditor.show();this._UIView.hide();return this._UIEditor.SetViewMode(g,f)}else{this._UIEditor.hide();this._UIView.show();return this._UIView.SetViewMode(g,f)}};b.prototype.GetViewModeH=function(){return this._UIView.GetViewModeH()};b.prototype.GetViewModeV=function(){return this._UIView.GetViewModeV()};b.prototype.MoveImage=function(g,f){return this._innerFun("MoveImage",e.makeParams(g,f))};b.prototype.SwitchImage=function(g,f){return this._innerFun("SwitchImage",e.makeParams(g,f))};b.prototype.Print=function(){_this._UIView.print()};b.prototype.OnRefreshUI=function(i,h,j){var l=this,f="On RefreshUI";if(j){var k=i*1,g=l._UIView.get(k);g.src=e.getServerImageUrl(l,k);l._UIView.set(g,k);l._UIEditor.refresh(k,h,true)}if(e.isFunction(l.__OnRefreshUI)){l.__OnRefreshUI(l._UIView.cIndex,h)}return true};b.prototype._OnBitmapChanged=function(h){var n=this,g=h[1].split(","),l=h[2],i=h[3],j=h[4],f="OnBitmapChanged:";n.__cIndex=i;n._HowManyImagesInBuffer=j;c.log(f+h);if(l==1||l==2){a.each(g,function(o){var p=parseInt(o),m="item_"+p;if(isNaN(p)||p<0){return true}e.addImageToUI(n,l,m,p,j)});if(e.isFunction(n.__OnRefreshUI)){n.__OnRefreshUI(undefined,j)}}else{if(l==3){var k=false;if(g.length==1&&g[0]==-1){n._UIView.clear();n._UIEditor.clear()}else{a.each(g,function(o,m){var p=parseInt(o);if(isNaN(p)||p<0){return true}n._UIView.remove(p)});if(i>=0&&!n.__bLoadingImage){n._UIView.go(i,function(){k=n.OnRefreshUI(i,j)});n._UIEditor.refresh(i,j)}if(j==0){n._UIEditor.refresh(-1,0)}}if(!k&&e.isFunction(n.__OnRefreshUI)){n.__OnRefreshUI(i,j)}}else{if(l==4){if(i>=0&&!n.__bLoadingImage){n.OnRefreshUI(i,j,true)}}}}if(e.isFunction(n.__OnBitmapChanged)){n.__OnBitmapChanged(g,l,i,j)}};b.prototype._OnPostLoad=function(g){var n=this,j,m,k,l,h;c.log("OnPostLoad Results:");l=g[1].split(",");m=c.base64.decode(l[0]);name=c.base64.decode(l[1]);c.log(m);c.log(name);c.log(l[2]);e.autoDiscardBlankImage(n,"On PostLoad");h=n.CurrentImageIndexInBuffer;if(h>=0){n.OnRefreshUI(h)}if(e.isFunction(n.__OnPostLoad)){n.__OnPostLoad(m,name,l[2])}};b.prototype._OnPostTransfer=function(f){var g=this;c.log("On PostTransfer Results:"+f);e.autoDiscardBlankImage(g,"On PostTransfer");if(e.isFunction(g.__OnPostTransfer)){g.__OnPostTransfer()}};b.prototype._OnPostAllTransfers=function(f){var h=this,g;c.log("On PostAllTransfers Results:"+f);if(e.isFunction(h.__OnPostAllTransfers)){h.__OnPostAllTransfers()}};b.prototype._OnResult=function(f){var h=this,g=f[1];if(e.isFunction(h.__OnResult)){h.__OnResult(g)}};b.prototype._OnTransferCancelled=function(f){var g=this;if(e.isFunction(g.__OnTransferCancelled)){g.__OnTransferCancelled()}};b.prototype._OnTransferError=function(f){var g=this;if(e.isFunction(g.__OnTransferError)){g.__OnTransferError()}};b.prototype._OnSourceUIClose=function(f){var g=this;if(e.isFunction(g.__OnSourceUIClose)){g.__OnSourceUIClose()}};b.prototype._OnPreTransfer=function(f){var g=this;if(e.isFunction(g.__OnPreTransfer)){g.__OnPreTransfer()}};b.prototype._OnPreAllTransfers=function(f){var g=this;if(e.isFunction(g.__OnPreAllTransfers)){g.__OnPreAllTransfers()}};b.prototype._OnPercentDone=function(o){var j=this;if(j.__IfShowProgressBar==true){var n=a.one("#progressBar");var i=a.one("#status");var k,l;if(DynamLib.cancelFrome==3||DynamLib.cancelFrome==4){var h=o[3];if(h==0){e.setBtnCancelVisibleForProgress(j,false)}else{if(h==1){e.setBtnCancelVisibleForProgress(j,true)}}}if(o[1]==-1){k=0;DynamLib.progressMessage=o[2];l=DynamLib.progressMessage}else{k=o[1];if(o[2]!=""){l=DynamLib.progressMessage+"("+o[2]+")"}else{l=DynamLib.progressMessage}}var f=a.one("#finalMessage");f.html(l);if(k){i.html(k+"%");n[0].value=k}if(k&&(k>=100||!DynamLib.showDialog)){if(!DynamLib.showDialog){var g="OnPercentDone";DynamLib.closeProgress(g)}}}if(e.isFunction(j.__OnPercentDone)){j.__OnPercentDone()}};b.prototype._OnGetFilePath=function(g){var m=this,h,l,j,k;k=g[1].split(",");c.log("On GetFilePath Results:"+g);l=c.base64.decode(k[3]);name=c.base64.decode(k[4]);if(e.isFunction(m.__OnGetFilePath)){m.__OnGetFilePath(k[0],k[1],k[2],l,name)}};b.prototype.checkErrorString=function(){var h=this,g=h.ErrorCode;if(g===-2115){return true}if(g===-2003){var f=window.open("","ErrorMessage","height=500,width=750,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no");f.document.writeln(h.__HTTPPostResponseString)}return(g===0)};b.prototype.FileExists=function(g){var h=e.replaceLocalFilename(g);return this._innerFun("FileExists",e.makeParams(h))};b.prototype.SaveAllAsMultiPageTIFF=function(g,h,j){var i=e.replaceLocalFilename(g);return this.__innerSaveImage("SaveAllAsMultiPageTIFF",e.makeParams(i),h,j)};b.prototype.SaveAllAsPDF=function(g,h,j){var i=e.replaceLocalFilename(g);return this.__innerSaveImage("SaveAllAsPDF",e.makeParams(i),h,j)};b.prototype.SaveAsBMP=function(g,h){var i=e.replaceLocalFilename(g);return this._innerFun("SaveAsBMP",e.makeParams(i,h))};b.prototype.SaveAsJPEG=function(g,h){var i=e.replaceLocalFilename(g);return this._innerFun("SaveAsJPEG",e.makeParams(i,h))};b.prototype.SaveAsPDF=function(g,h){var i=e.replaceLocalFilename(g);return this._innerFun("SaveAsPDF",e.makeParams(i,h))};b.prototype.SaveAsPNG=function(g,h){var i=e.replaceLocalFilename(g);return this._innerFun("SaveAsPNG",e.makeParams(i,h))};b.prototype.SaveAsTIFF=function(g,h){var i=e.replaceLocalFilename(g);return this._innerFun("SaveAsTIFF",e.makeParams(i,h))};b.prototype.SaveSelectedImagesAsMultiPagePDF=function(g,h,j){var i=e.replaceLocalFilename(g);return this.__innerSaveImage("SaveSelectedImagesAsMultiPagePDF",e.makeParams(i),h,j)};b.prototype.SaveSelectedImagesAsMultiPageTIFF=function(g,h,j){var i=e.replaceLocalFilename(g);return this.__innerSaveImage("SaveSelectedImagesAsMultiPageTIFF",e.makeParams(i),h,j)};b.prototype.SaveSelectedImagesToBase64Binary=function(){return this._innerFun("SaveSelectedImagesToBase64Binary")};b.prototype.ShowFileDialog=function(j,h,n,m,l,g,i,o){var k=e.replaceLocalFilename(l);return this._innerFun("ShowFileDialog",e.makeParams(j,h,n,m,k,g,i,o))};b.prototype.FTPDownload=function(i,g,f,h){return this.__innerFTPDownload("FTPDownload",e.makeParams(i,g),f,h)};b.prototype.FTPDownloadDirectly=function(l,j,g,h,k){var i=e.replaceLocalFilename(g);return this.__innerFTPDownloadDirectly("FTPDownloadDirectly",e.makeParams(l,j,i),h,k)};b.prototype.FTPDownloadEx=function(j,h,g,f,i){return this.__innerFTPDownload("FTPDownloadEx",e.makeParams(j,h,g),f,i)};b.prototype.FTPUpload=function(j,g,h,f,i){return this.__innerFTPUpload("FTPUpload",e.makeParams(j,g,h),f,i)};b.prototype.FTPUploadDirectly=function(l,g,j,h,k){var i=e.replaceLocalFilename(g);return this.__innerFTPUpload("FTPUploadDirectly",e.makeParams(l,i,j),h,k)};b.prototype.FTPUploadEx=function(k,g,i,h,f,j){return this.__innerFTPUpload("FTPUploadEx",e.makeParams(k,g,i,h),f,j)};b.prototype.FTPUploadAllAsMultiPageTIFF=function(i,g,f,h){return this.__innerFTPUpload("FTPUploadAllAsMultiPageTIFF",e.makeParams(i,g),f,h)};b.prototype.FTPUploadAllAsPDF=function(i,g,f,h){return this.__innerFTPUpload("FTPUploadAllAsPDF",e.makeParams(i,g),f,h)};b.prototype.FTPUploadAsMultiPagePDF=function(i,g,f,h){return this.__innerFTPUpload("FTPUploadAsMultiPagePDF",e.makeParams(i,g),f,h)};b.prototype.FTPUploadAsMultiPageTIFF=function(i,g,f,h){return this.__innerFTPUpload("FTPUploadAsMultiPageTIFF",e.makeParams(i,g),f,h)};b.prototype.HTTPDownload=function(h,g,f,j){var i=e.getImageType(g);return this.HTTPDownloadThroughGet(h,g,i,f,j)};b.prototype.HTTPDownloadDirectly=function(p,g,j,n,h){var l=this,i=e.combineUrl(l,p,g),m,k;DynamLib.cancelFrome=2;if(!j||j==""){c.appendMessage("Invalid LocalFile Name in HTTPDownloadDirectly function.");return false}k=e.replaceLocalFilename(j);m="get";c.showProgress(l,"HTTPDownloadDirectly",true);var o=function(f){var q=(f.total===0)?100:Math.round(f.loaded*100/f.total),r=[f.loaded," / ",f.total].join("");l._OnPercentDone([0,q,""])};l._OnPercentDone([0,-1,"HTTP Downloading..."]);e.loadHttpBlob(l,m,i,function(f){l._OnPercentDone([0,-1,"Loading..."]);var q=3;l.__LoadImageFromBytes(f,q,k,n,h)},function(){c.closeProgress("HTTPDownloadDirectly");if(e.isFunction(h)){h()}},o);return true};b.prototype.HTTPUploadThroughPostDirectly=function(i,g,f,k){var j=this,h=e.combineUrl(j,i,f);e.notSupportMethod("HTTPUploadThroughPostDirectly");return true};b.prototype.HTTPUploadThroughPost=function(i,h,f,l,g,k){var j=e.getImageType(l);return this.HTTPUploadThroughPostEx(i,h,f,l,j,g,k)};b.prototype.HTTPUploadThroughPostEx=function(o,q,f,j,k,n,g){var l=this,i=e.combineUrl(l,o,f),h="HTTPUploadThroughPostEx";DynamLib.cancelFrome=1;var p=function(m){if(e.isFunction(g)){g()}DynamLib.needShowTwiceShowDialog=false;c.closeProgress(h);if(e.isFunction(l.__OnPrintMsg)){l.__OnPrintMsg(m)}return true};DynamLib.needShowTwiceShowDialog=true;c.showProgress(l,h,false);if(o===""){l._errorCode=-2300;l._errorString="Http Upload Error: the HTTP Server cannot empty.";p(l._errorString);return false}l.__SaveSelectedImagesToBytes(k,q,function(m){DynamLib.needShowTwiceShowDialog=false;if(m&&(DynamLib.showDialog||l.__IfShowProgressBar==false)){m.name=j;e.setBtnCancelVisibleForProgress(l,true);e.httpPostUpload(l,i,m,function(){c.closeProgress(h);if(e.isFunction(n)){n()}},p)}else{c.closeProgress(h)}},p);return true};b.prototype.ClearAllHTTPFormField=function(){var f=this;f.httpFormFields={}};b.prototype.SetHTTPFormField=function(i,f){var h=this,g=i;if(!a.isString(g)){g=""+g}h.httpFormFields[g]=f};b.prototype.HTTPUploadAllThroughPostAsMultiPageTIFF=function(i,f,l,g,k){var h=-1,j=2;return this.HTTPUploadThroughPostEx(i,h,f,l,j,g,k)};b.prototype.HTTPUploadThroughPostAsMultiPageTIFF=function(i,f,l,h,k){var g=-2,j=2;return this.HTTPUploadThroughPostEx(i,g,f,l,j,h,k)};b.prototype.HTTPUploadAllThroughPostAsPDF=function(i,f,l,g,k){var h=-1,j=4;return this.HTTPUploadThroughPostEx(i,h,f,l,j,g,k)};b.prototype.HTTPUploadThroughPostAsMultiPagePDF=function(i,f,l,h,k){var g=-2,j=4;return this.HTTPUploadThroughPostEx(i,g,f,l,j,h,k)};b.prototype.HTTPUploadThroughPutDirectly=function(i,g,f){var j=this,h=e.combineUrl(j,i,f);e.notSupportMethod("HTTPUploadThroughPutDirectly");return true};b.prototype.HTTPUploadThroughPut=function(i,h,f,g,k){var j=e.getImageType(f);return this.HTTPUploadThroughPutEx(i,h,f,j,g,k)};b.prototype.HTTPUploadThroughPutEx=function(o,q,n,i,k,f){var j=this,h=e.combineUrl(j,o,n),g="HTTPUploadThroughPutEx";DynamLib.cancelFrome=1;var p=function(m){if(e.isFunction(f)){f()}DynamLib.needShowTwiceShowDialog=false;c.closeProgress(g);var r=["Http Upload Error: ",m].join("");if(e.isFunction(j.__OnPrintMsg)){j.__OnPrintMsg(r)}return true},l;if(o===""){j._errorCode=-2300;j._errorString="Error: the HTTP Server cannot empty.";p(j._errorString);return false}DynamLib.needShowTwiceShowDialog=true;c.showProgress(j,g,false);j.__SaveSelectedImagesToBytes(i,q,function(m){DynamLib.needShowTwiceShowDialog=false;if(m&&(DynamLib.showDialog||j.__IfShowProgressBar==false)){l=function(r){var s=(r.total===0)?100:Math.round(r.loaded*100/r.total),t=[r.loaded," / ",r.total].join("");j._OnPercentDone([0,s,""])};j._OnPercentDone([0,-1,"uploading..."]);e.setBtnCancelVisibleForProgress(j,true);e.httpPutImage(j,h,m,function(r){j.__HTTPPostResponseString=r;c.closeProgress(g);if(e.isFunction(k)){k()}},p,l)}else{c.closeProgress(g)}},p);return true};b.prototype.HTTPUploadAllThroughPutAsMultiPageTIFF=function(h,f){var g=-1,i=2;this.HTTPUploadThroughPutEx(h,g,f,i)};b.prototype.HTTPUploadThroughPutAsMultiPageTIFF=function(h,f){var g=-2,i=2;this.HTTPUploadThroughPutEx(h,g,f,i)};b.prototype.HTTPUploadAllThroughPutAsPDF=function(h,f){var g=-1,i=4;this.HTTPUploadThroughPutEx(h,g,f,i)};b.prototype.HTTPUploadThroughPutAsMultiPagePDF=function(h,f){var g=-2,i=4;this.HTTPUploadThroughPutEx(h,g,f,i)};b.prototype.ShowImageEditor=function(){return this.ShowImageEditorEx(-1,-1,-1,-1,0)};b.prototype.SetCookie=function(f){return this._innerFun("SetCookie",e.makeParams(f))};b.prototype.LoadImageFromBase64Binary=function(f,g){return this._innerFun("LoadImageFromBase64Binary",e.makeParams(f,g))};b.prototype.SaveSelectedImagesToBytes=function(g,f){};b.prototype.LoadImageFromBytes=function(h,f,g){};b.prototype.UnregisterEvent=function(f,h){var g=["__",f].join("");this[g]=null};b.prototype.LoadDibFromClipboard=function(g,f){return this.__innerAcquireImage("LoadDibFromClipboard",null,true,g,f)};b.prototype.LoadImage=function(h,i,g){var j=e.replaceLocalFilename(h);return this.__innerAcquireImage("LoadImage",e.makeParams(j),true,i,g)};b.prototype.LoadImageEx=function(h,k,i,g){var j=e.replaceLocalFilename(h);return this.__innerAcquireImage("LoadImageEx",e.makeParams(j,k),true,i,g)};b.prototype.EnableSource=function(h,g,f){return this.AcquireImage(h,g,f)};b.prototype.AcquireImage=function(i,h,f){var g;if(i!==undefined&&i!==null){g=["[",a.JSON.stringify(i),"]"].join("")}else{g=null}return this.__innerAcquireImage("AcquireImage",g,false,h,f)};b.prototype.__innerAcquireImage=function(f,k,i,h,g){var l=this;var j=function(m){l.__bLoadingImage=false;var n=l.CurrentImageIndexInBuffer;if(n>=0){l.OnRefreshUI(n)}if(e.isFunction(g)){g()}if(f=="LoadImage"||f=="LoadImageEx"){c.closeProgress(f)}else{e.hideMask(f)}if(m){c.log(m)}return false};if(f=="LoadImage"||f=="LoadImageEx"){c.showProgress(l,f,false)}else{e.showMask(f)}l.__bLoadingImage=true;l._innerSend(f,k,true,function(){if(f=="LoadImage"||f=="LoadImageEx"){c.closeProgress(f)}else{e.hideMask(f)}l.__bLoadingImage=false;var m=l.CurrentImageIndexInBuffer;if(m>=0){l.OnRefreshUI(m)}if(e.isFunction(h)){h()}},j);return true};b.prototype.__innerSaveImage=function(f,h,g,i){return this.__innerProgressFunction(f,h,false,g,i)};b.prototype.__innerFTPDownloadDirectly=function(f,h,g,i){DynamLib.cancelFrome=4;return this.__innerProgressFunction(f,h,true,g,i)};b.prototype.__innerFTPDownload=function(f,h,g,j){var i=this;DynamLib.cancelFrome=4;return this.__innerProgressFunction(f,h,true,function(){var k=i.CurrentImageIndexInBuffer;if(k>=0){i.OnRefreshUI(k)}var k=i.CurrentImageIndexInBuffer;if(e.isFunction(g)){g()}},j)};b.prototype.__innerFTPUpload=function(f,h,g,i){DynamLib.cancelFrome=3;return this.__innerProgressFunction(f,h,true,g,i)};b.prototype.__innerProgressFunction=function(f,j,g,h,l){var k=this;var i=function(m){if(e.isFunction(l)){l()}c.closeProgress(f);if(m){c.log(m)}return true};c.showProgress(k,f,g);this._innerSend(f,j,true,function(){c.closeProgress(f);if(e.isFunction(h)){h()}},i);return true};b.prototype._innerFun=function(f,h,i){var g=this._innerFunRaw(f,h,i);if(a.isArray(g)){return g[0]}return g};b.prototype._innerFunRaw=function(h,g,l){var j=this,f,o;if(!j.bReady||j.httpUrl===null){return""}j._errorCode=0;j._errorString="";f=[j.httpUrl,"f/",h,"?",Math.floor(Math.random()*100000+1)].join("");o=e.getJson(j,h,g);var n,i=false,k=null;if(l){i=true}if(!i){e.showMask(h);k=function(m){e.hideMask(h)}}new KISSY.IO({type:"post",url:f,data:o,async:i,headers:{"X-Requested-With":false},complete:k,success:function(m){if(m!==undefined&&m!==null){if(m.exception!==undefined&&m.description!==undefined){j._errorCode=m.exception;j._errorString=m.description}else{j._errorCode=0;j._errorString=""}n=m.result}else{j._errorCode=-2302;j._errorString="Error: invalid result format.";n=""}},error:function(){j._errorCode=-2301;j._errorString="Network error";n=""}});return n};b.prototype._innerSend=function(i,f,h,k,n){var l=this,g=l._objWS,o=false,j=false;if(g===null||!l.bReady){if(e.isFunction(n)){n()}return}if(e.isFunction(k)){j=k}if(e.isFunction(n)){o=n}l.curCommand.push({cmd:i,sFun:j,fFun:o});e.sendData(g,e.getJson(l,i,f),false,h)};b.prototype.__SaveSelectedImagesToBytes=function(h,f,g,i){return this._innerSend("SaveSelectedImagesToBytes",e.makeParams(h,f),true,g,i)};b.prototype.__LoadImageFromBytes=function(q,j,l,o,h){var k=this,i="LoadImageFromBytes",s=j||3,n=q.size,g=["[",n,",",0,",",s,',"',l,'"]'].join("");if(n===0){c.appendRawMessage("The file length is 0.");return false}var r=function(){c.closeProgress(i);k.__bLoadingImage=false;var f=k.CurrentImageIndexInBuffer;if(f>=0){k.OnRefreshUI(f)}if(e.isFunction(h)){h()}};k.__bLoadingImage=true;e.setBtnCancelVisibleForProgress(k,false);return this._innerSendBlob(i,g,q,function(){c.closeProgress(i);k.__bLoadingImage=false;var f=k.CurrentImageIndexInBuffer;if(f>=0){k.OnRefreshUI(f)}if(e.isFunction(o)){o()}},r)};b.prototype._innerSendBlob=function(h,f,n,i,l){var k=this,g=k._objWS,j=false,o=false;if(g===null){if(e.isFunction(l)){l()}return}if(e.isFunction(i)){j=i}if(e.isFunction(l)){o=l}k.curCommand.push({cmd:h,sFun:j,fFun:o});var q=e.getJson(k,h,f);e.sendData(g,q,n,true)};b.prototype.ActiveUI=function(f,g){this._innerSend("ActiveUI",e.makeParams(DynamLib.env.WSVersion),false,f,g)};b.prototype.SetCancel=function(f,g){this._innerSend("SetCancel",null,true,f,g)};b.prototype.SetImageWidth=function(f,g){return this._innerFun("SetImageWidth",e.makeParams(f,g))};b.prototype.HttpDownloadThroughPost=function(n,f,i,l,g){var j=this,h=e.combineUrl(j,n,f),k;DynamLib.cancelFrome=2;c.showProgress(j,"HttpDownloadThroughPost",true);k="post";var m=function(o){var q=(o.total===0)?100:Math.round(o.loaded*100/o.total),r=[o.loaded," / ",o.total].join("");j._OnPercentDone([0,q,""])};j._OnPercentDone([0,-1,"HTTP Downloading..."]);e.loadHttpBlob(j,k,h,function(o){j._OnPercentDone([0,-1,"Loading..."]);var q="",p=i;if(p<-1||p>5){p=-1}j.__LoadImageFromBytes(o,p,q,l,g)},function(){c.closeProgress("HttpDownloadThroughPost");if(e.isFunction(g)){g()}},m);return true};b.prototype.HTTPDownloadEx=function(h,g,i,f,k){var j=this;return j.HTTPDownloadThroughGet(h,g,i,f,k)};b.prototype.HTTPDownloadThroughGet=function(n,f,i,l,g){var j=this,h=e.combineUrl(j,n,f),k;DynamLib.cancelFrome=2;k="get";c.showProgress(j,"HTTPDownloadThroughGet",true);var m=function(o){var q=(o.total===0)?100:Math.round(o.loaded*100/o.total),r=[o.loaded," / ",o.total].join("");j._OnPercentDone([0,q,""])};j._OnPercentDone([0,-1,"HTTP Downloading..."]);e.loadHttpBlob(j,k,h,function(o){j._OnPercentDone([0,-1,"Loading..."]);var q="",p=i;if(p<-1||p>5){p=-1}j.__LoadImageFromBytes(o,p,q,l,g)},function(){c.closeProgress("HTTPDownloadThroughGet");if(e.isFunction(g)){g()}},m);return true};b.prototype.SetCustomDSDataEx=function(f){return this._innerFun("SetCustomDSDataEx",e.makeParams(f))};b.prototype.SetCustomDSData=function(g){var h=e.replaceLocalFilename(g);return this._innerFun("SetCustomDSData",e.makeParams(h))};b.prototype.GetCustomDSDataEx=function(){return this._innerFun("GetCustomDSDataEx")};b.prototype.GetCustomDSData=function(g){var h=e.replaceLocalFilename(g);return this._innerFun("GetCustomDSData",e.makeParams(h))};b.prototype.ChangeBitDepth=function(g,f,h){return this._innerFun("ChangeBitDepth",e.makeParams(g,f,h))};b.prototype.ConvertToGrayScale=function(f){return this._innerFun("ConvertToGrayScale",e.makeParams(f))};b.prototype.ShowImageEditorEx=function(g,k,f,j,h){var i=this;i._UIEditor.refresh(i.__cIndex,i._HowManyImagesInBuffer);i._UIEditor.ShowImageEditorEx(g,k,f,j,h);return true};b.prototype.ClearTiffCustomTag=function(){return this._innerFun("ClearTiffCustomTag")};b.prototype.SetTiffCustomTag=function(g,f,h){return this._innerFun("SetTiffCustomTag",e.makeParams(g,f,h))};b.prototype.IsBlankImage=function(f){return this._innerFun("IsBlankImage",e.makeParams(f,false))};b.prototype.IsBlankImageExpress=function(f){return this._innerFun("IsBlankImage",e.makeParams(f,true))};b.prototype.__SetSelectedImages=function(g,h,f,i){this._innerSend("SetSelectedImages",e.makeParams(g,h),true,f,i)};b.prototype.OnReady=function(j){var i=this,h=c.detect.urls[c.detect.cUrlIndex],g=c.getHttpUrl(h),f=i._objWS;var f=i._objWS;if(f===null){return}DynamLib.detect.starting=false;DynamLib.detect.bOK=true;i.bReady=true;f.onopen=null;i.httpUrl=g;f.onmessage=function(p){var q=p.data;if(typeof(q)==="object"){var k=i.curCommand.pop();if(k.sFun){k.sFun(q)}return}if(i.__OnWSMessage){i.__OnWSMessage(q)}var m=q.replace(/\0/g,"");if(m.indexOf("Exception:")>=0||m.indexOf("Error")==0){var o=q,n=false,k=i.curCommand.pop();if(k.fFun){n=k.fFun(o)}if(!n&&e.isFunction(i.__OnPrintMsg)){i.__OnPrintMsg(o)}return}m=a.JSON.parse(m);if(m.event){e.handleEvent(i,m);return}var k=i.curCommand.pop();if(m.exception!==undefined&&m.description!==undefined){i._errorCode=m.exception;i._errorString=m.description}else{i._errorCode=0;i._errorString=""}if(m.result.length&&m.result[0]=="1"){if(k.sFun){k.sFun()}}else{if(m.exception){var n=false;if(k.fFun){n=k.fFun(i._errorString)}if(!n&&m.exception&&m.exception<0&&m.exception!=-2115){if(e.isFunction(i.__OnPrintMsg)){i.__OnPrintMsg(i._errorString)}}}else{var l=["result:"];if(k.fFun){k.fFun(e.__pushElement(l,m.result))}}}};f.onclose=function(){i.bReady=false;DynamLib.detect.bOK=false;if(!DynamLib.detect.starting){for(var k=0;k<c.detect.arySTwains.length;k++){if(c.detect.arySTwains[k]==i){c.detect.cTwainIndex=k;break}}setTimeout(DynamLib._reconnect,100);DynamLib.detect.starting=true}if(i.__OnWSClose){i.__OnWSClose()}e.hideMask(true)};f.onerror=function(l){i.bReady=false;DynamLib.detect.bOK=false;if(!DynamLib.detect.starting){for(var k=0;k<c.detect.arySTwains.length;k++){if(c.detect.arySTwains[k]==i){c.detect.cTwainIndex=k;break}}setTimeout(DynamLib._reconnect,100);DynamLib.detect.starting=true}if(l){DynamLib.log("websocket error: "+l)}if(i.__OnWSError){i.__OnWSError()}e.hideMask(true)};if(j){i.ActiveUI(function(){i._HowManyImagesInBuffer=i._innerFun("HowManyImagesInBuffer");if(i._HowManyImagesInBuffer==0){i._OnBitmapChanged([0,"-1",3,-1,0])}});return}c.LS.item("D_port",h.port);c.LS.item("D_ssl",h.ssl?"true":"false");i.SetViewMode(1,1);i.ActiveUI(function(){i.__versionInfo=i._innerFun("VersionInfo");if(i.ErrorCode==0&&c.product.ProductKey!==""){i.ProductKey=c.product.ProductKey}if(e.isFunction(i.__OnWSReady)){var k=c.getWSUrl(h);i.__OnWSReady(k,g)}})};c.WebTwain=function(f){var h=c,g=new b(f);h.detect.arySTwains.push(g);if(h.detect.bFirst){h._init()}h.detect.bFirst=false;return g}})(DynamLib,KISSY);function visibilityChanged(){if(!document.hidden&&DynamLib.detect.arySTwains.length>0){DynamLib.detect.arySTwains[0].ActiveUI()}}(function(){var b="hidden";function a(d){var e="visible",f="hidden",c={focus:e,focusin:e,pageshow:e,blur:f,focusout:f,pagehide:f};d=d||window.event;if(d.type in c){document.body.className=c[d.type]}else{document.body.className=this[b]?"hidden":"visible"}}if(b in document){document.addEventListener("visibilitychange",a)}else{if((b="mozHidden") in document){document.addEventListener("mozvisibilitychange",a)}else{if((b="webkitHidden") in document){document.addEventListener("webkitvisibilitychange",a)}else{if((b="msHidden") in document){document.addEventListener("msvisibilitychange",a)}else{if("onfocusin" in document){document.onfocusin=document.onfocusout=a}else{window.onpageshow=window.onpagehide=window.onfocus=window.onblur=a}}}}}if(document.addEventListener){document.addEventListener("visibilitychange",visibilityChanged)}})();
